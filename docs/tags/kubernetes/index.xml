<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>kubernetes on </title>
    <link>https://zhangsiming-blyq.github.io/tags/kubernetes/</link>
    <description>Recent content in kubernetes on </description>
    <generator>Hugo -- gohugo.io</generator>
    <copyright>Copyright Â© 2008â€“2018, Steve Francia and the Hugo Authors; all rights reserved.</copyright>
    <lastBuildDate>Sat, 21 Sep 2024 16:00:00 +0000</lastBuildDate><atom:link href="https://zhangsiming-blyq.github.io/tags/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Kubernetes ä¸­ Cilium ç½‘ç»œæ¶æ„è¯¦è§£ä¸æµé‡å¤„ç†æµç¨‹</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/cilium/</link>
      <pubDate>Sat, 21 Sep 2024 16:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/cilium/</guid>
      <description>
        
          
            1. Cilium å’Œ Cilium-Operator çš„ç½‘ç»œæ¶æ„ åœ¨ Kubernetes é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Cilium ä½œä¸ºç½‘ç»œæ’ä»¶ï¼ŒåŸºäº eBPF æä¾›é«˜æ•ˆçš„ç½‘ç»œåŠŸèƒ½ï¼Œå¦‚æµé‡æ§åˆ¶ã€è´Ÿè½½å‡è¡¡ã€ç½‘ç»œå®‰å…¨ç­–ç•¥ç­‰ã€‚åŒæ—¶ï¼ŒCilium-Operator è´Ÿè´£ç®¡ç†é›†ç¾¤èŒƒå›´çš„ Cilium æ“ä½œï¼ŒåŒ…æ‹¬ IP åœ°å€ç®¡ç†ã€æœåŠ¡å‘ç°ã€BGP å®£å‘Šå’Œé…ç½®åŒæ­¥ç­‰ã€‚
2. IP åˆ†é…ä¸ Cilium-Host çš„ä½œç”¨ 2.1 Cilium å¦‚ä½•åˆ†é… IP åœ°å€ Pod åˆ›å»ºæ—¶çš„ IP åˆ†é…ï¼šå½“ Kubernetes ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ Pod æ—¶ï¼ŒCilium çš„ CNI æ’ä»¶ è´Ÿè´£ä¸ºè¯¥ Pod åˆ†é… IP åœ°å€ã€‚è¿™ä¸ Kubernetes Controller Manager ååŒå®Œæˆã€‚åœ¨æˆ‘ä»¬å…¬å¸çš„åœºæ™¯ä¸­ï¼ŒCilium ä½¿ç”¨çš„æ˜¯å…¬å¸å†…éƒ¨çš„ç‰©ç† IP åœ°å€ï¼Œè¿™äº›åœ°å€æ˜¯ä»å…¬å¸å†…éƒ¨çš„ä¸€ä¸ªä¸“é—¨çš„ IP åœ°å€æ± ä¸­åˆ†é…çš„ï¼Œä»¥ç¡®ä¿ Pod åœ¨å…¬å¸å†…éƒ¨çš„ç½‘ç»œä¸­èƒ½å¤Ÿè¢«è¯†åˆ«å’Œè®¿é—®ã€‚
é€šè¿‡ Cilium CNI æ’ä»¶å°† IP åˆ†é…åˆ° Podï¼šCilium ä½œä¸º Kubernetes çš„ CNI æ’ä»¶ï¼Œè´Ÿè´£ä¸ºæ–°åˆ›å»ºçš„ Pod åˆ†é… IP åœ°å€ï¼Œå¹¶å°†è¯¥ IP ç»‘å®šåˆ° Pod çš„è™šæ‹Ÿç½‘ç»œæ¥å£ï¼ˆvethï¼‰ã€‚Cilium é€šè¿‡ CNI æ¥å£å‘ Kubernetes æŠ¥å‘Šè¿™äº›ä¿¡æ¯ï¼Œç¡®ä¿ Kubernetes çš„ç½‘ç»œé…ç½®ä¸ Cilium çš„ eBPF é…ç½®ä¸€è‡´ã€‚
          
          
        
      </description>
    </item>
    
    <item>
      <title>Kubernetes Operator æ–°æ‰‹å¼€å‘ä¸€æ–‡å…¥é—¨</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/operator/</link>
      <pubDate>Sun, 15 Sep 2024 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/operator/</guid>
      <description>
        
          
            æ¦‚è¿° Kubernetes Operator ç®€ä»‹ Kubernetes Operator æ˜¯ä¸€ç±» Kubernetes æ§åˆ¶å™¨ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨åŒ–ç®¡ç†å¤æ‚çš„åº”ç”¨ç¨‹åºå’Œå…¶ç”Ÿå‘½å‘¨æœŸï¼Œé€šå¸¸è¢«ç”¨æ¥ç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ï¼ˆå¦‚æ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼‰ã€‚é€šè¿‡æ‰©å±• Kubernetes APIï¼ŒOperator å¯ä»¥å°†æ—¥å¸¸æ“ä½œæµç¨‹ï¼ˆå¦‚å®‰è£…ã€å‡çº§ã€æ‰©å±•ã€å¤‡ä»½ç­‰ï¼‰è½¬æ¢ä¸º Kubernetes åŸç”Ÿå¯¹è±¡ï¼Œä»è€Œå®ç°è‡ªåŠ¨åŒ–å’Œå£°æ˜å¼ç®¡ç†ã€‚
ä¸ºä»€ä¹ˆä½¿ç”¨ Operator Operator é€šè¿‡å°† DevOps å›¢é˜Ÿæ—¥å¸¸ç®¡ç†åº”ç”¨çš„è¿ç»´çŸ¥è¯†å’Œæµç¨‹ç¼–ç åŒ–ï¼Œä½¿å¤æ‚çš„åº”ç”¨ç¨‹åºç®¡ç†å˜å¾—ç®€å•å’Œè‡ªåŠ¨åŒ–ã€‚åœ¨ Kubernetes ä¸­ï¼ŒOperator å¯ä»¥æŒç»­ç›‘æ§è‡ªå®šä¹‰èµ„æºï¼Œå¹¶è‡ªåŠ¨è¿›è¡Œç›¸åº”æ“ä½œï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„çŠ¶æ€ä¸ç”¨æˆ·æœŸæœ›ä¸€è‡´ã€‚
Operator ä¸ Controller çš„å…³ç³» Operator å®é™…ä¸Šæ˜¯ä¸€ä¸ªé«˜çº§ Controllerï¼Œå®ƒä¸ä»…è´Ÿè´£ç›‘æ§å’Œç®¡ç† Kubernetes ä¸­çš„è‡ªå®šä¹‰èµ„æº (CR)ï¼Œè¿˜å¯ä»¥æ‰§è¡Œç‰¹å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚Controller æ˜¯ Kubernetes æ¶æ„ä¸­ç®¡ç†èµ„æºçŠ¶æ€çš„æ ¸å¿ƒç»„ä»¶ï¼ŒOperator æ˜¯å¯¹ Controller çš„å°è£…å’Œæ‰©å±•ï¼Œä¸“é—¨ç”¨äºå¤æ‚åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
æ ¸å¿ƒæ¦‚å¿µ è‡ªå®šä¹‰èµ„æº (CR) å’Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ (CRD) ä»€ä¹ˆæ˜¯ CR è‡ªå®šä¹‰èµ„æº (Custom Resource, CR) æ˜¯ Kubernetes ç”¨æˆ·å¯ä»¥å®šä¹‰çš„æ‰©å±•å¯¹è±¡ï¼Œç”¨äºæè¿°æŸä¸ªå…·ä½“çš„åº”ç”¨æˆ–èµ„æºçš„æœŸæœ›çŠ¶æ€ã€‚æ¯ä¸ª CR å¯¹è±¡çš„ç»“æ„åŸºäºå…¶ç›¸åº”çš„ CRD (Custom Resource Definition)ï¼Œé€šè¿‡ CRï¼Œç”¨æˆ·å¯ä»¥å£°æ˜ä»–ä»¬å¸Œæœ› Kubernetes ç®¡ç†çš„ç‰¹å®šåº”ç”¨æˆ–æœåŠ¡ã€‚
ä»€ä¹ˆæ˜¯ CRD CRDï¼ˆè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰æ˜¯ Kubernetes çš„ä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·å‘ Kubernetes API æ·»åŠ æ–°çš„å¯¹è±¡ç±»å‹ã€‚é€šè¿‡ CRDï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰æ–°çš„èµ„æºç§ç±»ï¼ˆç±»ä¼¼äºå†…ç½®çš„ Podã€Service ç­‰ï¼‰ï¼Œå¹¶æŒ‡å®šè¿™äº›èµ„æºçš„ç»“æ„å’Œè¡Œä¸ºã€‚
          
          
        
      </description>
    </item>
    
    <item>
      <title>Deploy Kubernetes cluster via kubeadm</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/kubeadm/</link>
      <pubDate>Tue, 10 Sep 2024 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/kubeadm/</guid>
      <description>
        
          
            1. Install kubeadm(kubelet kubectl) and docker https://docs.docker.com/engine/install/ubuntu/
Set up docker apt repository:
1# Add Docker&amp;#39;s official GPG key: 2sudo apt-get update 3sudo apt-get install ca-certificates curl 4sudo install -m 0755 -d /etc/apt/keyrings 5sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc 6sudo chmod a+r /etc/apt/keyrings/docker.asc 7 8# Add the repository to Apt sources: 9echo \ 10 &amp;#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \ 11 $(. /etc/os-release &amp;amp;&amp;amp; echo &amp;#34;$VERSION_CODENAME&amp;#34;) stable&amp;#34; | \ 12 sudo tee /etc/apt/sources.
          
          
        
      </description>
    </item>
    
    <item>
      <title>å¦‚ä½•åŠ èŠ‚ç‚¹åˆ°Kubernetesé›†ç¾¤</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/addnode/</link>
      <pubDate>Tue, 10 Sep 2024 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/addnode/</guid>
      <description>
        
          
            æ–¹æ³•ä¸€ï¼šåŸºäº Bootstrap Token çš„åŠ å…¥æ–¹å¼ åŸç† Bootstrap Token æ˜¯ä¸€ç§ä¸´æ—¶çš„ä»¤ç‰Œï¼Œç”¨äºæ–°èŠ‚ç‚¹åœ¨åŠ å…¥é›†ç¾¤æ—¶è¿›è¡Œèº«ä»½éªŒè¯ã€‚ æ–°èŠ‚ç‚¹ä½¿ç”¨ kubeadm join å‘½ä»¤ï¼Œæä¾› --token å’Œ --discovery-token-ca-cert-hash å‚æ•°ï¼Œä¸æ§åˆ¶å¹³é¢ API æœåŠ¡å™¨å»ºç«‹å®‰å…¨è¿æ¥ã€‚ æ§åˆ¶å¹³é¢éªŒè¯ token çš„æœ‰æ•ˆæ€§ï¼Œå¹¶å‘æ–°èŠ‚ç‚¹æä¾›æ‰€éœ€çš„è¯ä¹¦å’Œé…ç½®æ–‡ä»¶ï¼Œä½¿å…¶èƒ½å¤ŸåŠ å…¥é›†ç¾¤ã€‚ å…·ä½“æ­¥éª¤ 1. åœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šç”Ÿæˆ Bootstrap Token ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ–°çš„å¼•å¯¼ä»¤ç‰Œï¼š
1kubeadm token create --print-join-command è¾“å‡ºç¤ºä¾‹ï¼š
1kubeadm join 10.0.24.14:6443 --token abcdef.0123456789abcdef \ 2 --discovery-token-ca-cert-hash sha256:430cb53669a7fde6e44338968458d47f3fcdbeda4d73bda7435df34ed20ad5be --print-join-command å‚æ•°ä¼šç›´æ¥è¾“å‡ºç”¨äºåŠ å…¥é›†ç¾¤çš„å®Œæ•´å‘½ä»¤ï¼ŒåŒ…æ‹¬ token å’Œ discovery-token-ca-cert-hashã€‚ 2. åœ¨æ–°èŠ‚ç‚¹ä¸Šæ‰§è¡ŒåŠ å…¥å‘½ä»¤ åœ¨æ–°èŠ‚ç‚¹ä¸Šï¼Œä»¥ root æˆ–å…·æœ‰ç›¸åº”æƒé™çš„ç”¨æˆ·èº«ä»½æ‰§è¡Œä¸Šè¿°è¾“å‡ºçš„å‘½ä»¤ï¼š
1kubeadm join 10.0.24.14:6443 --token abcdef.0123456789abcdef \ 2 --discovery-token-ca-cert-hash sha256:430cb53669a7fde6e44338968458d47f3fcdbeda4d73bda7435df34ed20ad5be 3. åŠ å…¥è¿‡ç¨‹è§£æ èº«ä»½éªŒè¯ï¼šæ–°èŠ‚ç‚¹ä½¿ç”¨ token ä¸æ§åˆ¶å¹³é¢ API æœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚ è¯ä¹¦éªŒè¯ï¼šä½¿ç”¨ --discovery-token-ca-cert-hash æä¾›çš„å“ˆå¸Œå€¼ï¼Œç¡®ä¿è¿æ¥çš„ API æœåŠ¡å™¨æ˜¯å¯ä¿¡çš„ã€‚ è·å–é…ç½®ï¼šéªŒè¯é€šè¿‡åï¼Œæ–°èŠ‚ç‚¹ä»æ§åˆ¶å¹³é¢è·å– kubelet æ‰€éœ€çš„é…ç½®æ–‡ä»¶å’Œè¯ä¹¦ã€‚ èŠ‚ç‚¹æ³¨å†Œï¼škubelet å¯åŠ¨å¹¶ä¸æ§åˆ¶å¹³é¢é€šä¿¡ï¼ŒèŠ‚ç‚¹è¢«æ³¨å†Œåˆ°é›†ç¾¤ä¸­ã€‚ æ³¨æ„äº‹é¡¹ Token æœ‰æ•ˆæœŸï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œtoken æœ‰æ•ˆæœŸä¸º 24 å°æ—¶ã€‚å¯ä»¥ä½¿ç”¨ --ttl å‚æ•°è°ƒæ•´æœ‰æ•ˆæœŸã€‚ Token ç®¡ç†ï¼šä½¿ç”¨ kubeadm token list æŸ¥çœ‹ç°æœ‰ tokenï¼Œkubeadm token delete &amp;lt;token-id&amp;gt; åˆ é™¤ tokenã€‚ æ–¹æ³•äºŒï¼šä½¿ç”¨ é™æ€ Kubeconfig æ–‡ä»¶ çš„æ–¹å¼(è¿™ç§æ˜¯æœ€å¸¸è§„çš„, æœ€æ­£ç¡®çš„) åŸç† é¢„å…ˆåœ¨æ§åˆ¶å¹³é¢èŠ‚ç‚¹ä¸Šä¸ºæ–°èŠ‚ç‚¹ç”Ÿæˆ kubeconfig æ–‡ä»¶ï¼ŒåŒ…å«å¿…è¦çš„è¯ä¹¦å’Œé…ç½®ä¿¡æ¯ã€‚ å°† kubeconfig æ–‡ä»¶å®‰å…¨åœ°ä¼ è¾“åˆ°æ–°èŠ‚ç‚¹ã€‚ æ–°èŠ‚ç‚¹çš„ kubelet ä½¿ç”¨è¯¥ kubeconfig æ–‡ä»¶ä¸æ§åˆ¶å¹³é¢é€šä¿¡ï¼Œå®ŒæˆåŠ å…¥è¿‡ç¨‹ã€‚ å…·ä½“æ­¥éª¤ 1.
          
          
        
      </description>
    </item>
    
    <item>
      <title>kuberneteså¸¸è§„é—®é¢˜</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes%E5%B8%B8%E8%A7%84%E9%97%AE%E9%A2%98/</link>
      <pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes%E5%B8%B8%E8%A7%84%E9%97%AE%E9%A2%98/</guid>
      <description>
        
          
             kubernetesçš„cordonæ‰“ä¸Šçš„SchedulingDisabledä»…ä»…å½±å“è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æ‰“ä¸ŠnodeNameä¸ä¼šå—åˆ°è¯¥å‚æ•°çš„å½±å“ kubernetesçš„QosClassåˆ¤æ–­podå†…çš„å…¨éƒ¨containerï¼ŒåŒ…æ‹¬init-containerï¼Œä¹Ÿå°±æ˜¯å¦‚æœinit-containerä¸è¿›è¡Œé™åˆ¶ï¼Œå…¶ä»–containeræ— è®ºæ€ä¹ˆé…ç½®ä»ç„¶ä¸æ˜¯Guaranteed kubernetesé›†ç¾¤æ–°ç‰ˆæœ¬å¦‚æœcordonæ‰“ä¸Šunscheduleï¼Œä¼šé»˜è®¤è¿½åŠ Taintï¼›æ—§ç‰ˆæœ¬ä¸ä¼š kubernetesé›†ç¾¤å¯¹äºunscheduleçš„èŠ‚ç‚¹ä¸ä¼šèµ°å…¥è°ƒåº¦ç¯èŠ‚ï¼Œåªæœ‰å¯ä»¥æ­£å¸¸è°ƒåº¦çš„èŠ‚ç‚¹æ‰ä¼šèµ°åˆ°åé¢åˆ¤æ–­Tolerationï¼Œlabelç­‰ï¼›ç‰¹åˆ«åœ°ï¼Œå¯¹äºdaemonsetçš„podï¼ŒschedulingDisableæ— æ•ˆï¼Œä½†æ˜¯toleranceç­‰æœ‰æ•ˆ(v1.17ç‰ˆæœ¬ä¸­ï¼ŒDamoneset çš„ pod çš„è°ƒåº¦ä» daemonset controller è¿ç§»åˆ° kube-scheduler æ¥åšè°ƒåº¦ï¼Œä»è€Œæ”¯æŒ PodAffnityã€PodAntiAffinity ç­‰èƒ½åŠ›) Error(ä¸å†é‡å¯)ï¼ŒCompletedçŠ¶æ€çš„podipä¼šæ˜¾ç¤ºï¼Œä½†æ˜¯å®é™…ä¸å ç”¨podipï¼ŒçœŸå®podipå·²ç»åˆ†é…ç»™å…¶ä»–æœåŠ¡ä½¿ç”¨ kubernetesä¸­ï¼Œkubeleté™åˆ¶çš„max-podæ•°é‡æ˜¯é™åˆ¶çš„å…·ä½“çš„podæ•°é‡ï¼Œè¶…å‡ºä¼šæŠ¥é”™Outofpods æ¯æ¬¡podé‡å¯ï¼Œkubeletä¼šç»™ä»–åˆ†é…æ–°çš„cgroupç›®å½•è·¯å¾„ï¼Œè€Œä¸ä¼šä½¿ç”¨åŸæ¥çš„ï¼›æ–°çš„podå¯åŠ¨ä¹‹åé—´éš”ä¸€å°æ®µæ—¶é—´ä¼šåˆ é™¤æ—§çš„cgroupè·¯å¾„ kubernetes æ¨èä½¿ç”¨ systemd æ¥ä»£æ›¿ cgroupfs; å› ä¸ºsystemdæ˜¯kubernetesè‡ªå¸¦çš„cgroupç®¡ç†å™¨, è´Ÿè´£ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…cgroups; ä½†dockerçš„cgroup driveré»˜è®¤æ˜¯cgroupfs,è¿™æ ·å°±åŒæ—¶è¿è¡Œæœ‰ä¸¤ä¸ªcgroupæ§åˆ¶ç®¡ç†å™¨ï¼›å¯ä»¥ä½¿ç”¨docker infoæŸ¥çœ‹dockerä½¿ç”¨çš„cgroup driverï¼Œç„¶åä»&amp;quot;/etc/docker/daemon.json&amp;quot;ä¸­ä¿®æ”¹æˆsystemd 
          
          
        
      </description>
    </item>
    
    <item>
      <title>åœ¨defaultå‘½åç©ºé—´ä¸‹çš„svc, kubernetes</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes-default-svc/</link>
      <pubDate>Fri, 24 Feb 2023 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes-default-svc/</guid>
      <description>
        
          
            
è¯¥svcä½œä¸ºé›†ç¾¤å†…éƒ¨æœåŠ¡è¿æ¥api-serverçš„åª’ä»‹(è¿™ä¸‰ä¸ªä¿¡æ¯ä¼šè¢«æ³¨å…¥åˆ°æ¯ä¸ªé›†ç¾¤å†…éƒ¨çš„podä¸­: KUBERNETES_SERVICE_HOST=10.96.0.1ã€KUBERNETES_SERVICE_PORT=443ã€KUBERNETES_SERVICE_PORT_HTTPS=443) æ°¸è¿œä½¿ç”¨&amp;quot;--service-cluster-ip-range&amp;quot;å®šä¹‰çš„CIDRçš„ç¬¬ä¸€ä¸ªipåœ°å€ svcä»¥åŠå¯¹åº”çš„endpointséƒ½æ˜¯ç”±master controller(api-serveräºŒè¿›åˆ¶æ–‡ä»¶åœ¨æœ€å¼€å§‹å¯åŠ¨çš„controllerä¹‹ä¸€)ç®¡æ§ RunKubernetesService()æ˜¯ä¸€ä¸ªå¾ªç¯ï¼Œé‡Œé¢çš„é€»è¾‘åŒ…å«æ”¯æŒUpdateKubernetesService()æ›´æ–°è¿™ä¸ªsvcä¿¡æ¯ï¼ŒReconcileEndpoints(...endpointPorts []corev1.EndpointPort...)æ¥æ›´æ–°endpointï¼Œä¹Ÿå°±æ˜¯ä¸€èˆ¬3ä¸ªmasterçš„ä¿¡æ¯ï¼›ä¸è¿‡æœ‰æ—¶å€™çœ‹åˆ°çš„endpointå¯èƒ½åªæœ‰ä¸€ä¸ªipï¼Œè¿™å¯èƒ½æ˜¯äº‘å‚å•†ä¼ å…¥çš„master lbå±‚ å‚è€ƒé“¾æ¥: https://networkop.co.uk/post/2020-06-kubernetes-default/ 
          
          
        
      </description>
    </item>
    
    <item>
      <title>è°ˆè°ˆkubernetes è¯ä¹¦è®¤è¯é‚£äº›äº‹å„¿</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes-certificate/</link>
      <pubDate>Mon, 12 Sep 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes-certificate/</guid>
      <description>
        
          
            kuberneteså„ä¸ªç»„ä»¶éƒ½æ˜¯åŠ å¯†é€šä¿¡çš„, é‚£ä¹ˆéƒ½æœ‰å“ªäº›è¯ä¹¦ã€å„ä¸ªè¯ä¹¦æ€ä¹ˆäº¤äº’ã€è¿™äº›è¯ä¹¦ä»€ä¹ˆæ—¶å€™è¿‡æœŸï¼Œè¿™ä¸ªå°±å˜å¾—è‡³å…³é‡è¦; æœ¬æ–‡å¼•ç”¨äº†ä¸€äº›å…¶ä»–ç½‘ç»œå†…å®¹(å‡å·²é™„ä¸ŠåŸæ–‡é“¾æ¥)ï¼Œå¹¶é€‚å½“è¡¥å……å®Œå–„ï¼Œç”¨äºè®©æ–°æ‰‹å®Œå–„ç†Ÿæ‚‰kubernetesè¯ä¹¦ä½“ç³»(å¦‚æœ‰ä¾µæƒè”ç³»é‚®ç®±å¯ä»¥åˆ é™¤)ã€‚
ä¸€ã€æ•°å­—è¯ä¹¦åŸç† 1.1 ä¼ ç»Ÿéå¯¹ç§°åŠ å¯† 1message --&amp;gt; (å…¬é’¥åŠ å¯†) --&amp;gt; || ä¼ è¾“ || --&amp;gt; (ç§é’¥è§£å¯†) --&amp;gt; message æ³¨æ„:
1.è¿™é‡Œä¸æ•°å­—è¯ä¹¦è®¤è¯ç›¸åï¼Œæ˜¯å…¬é’¥åŠ å¯†ç§é’¥è§£å¯†
2.å…¬é’¥ç§é’¥éœ€è¦æ˜¯ä¸€ä¸ªç§˜é’¥å¯¹
1.2 å“ˆå¸Œå‡½æ•° 1message --&amp;gt; H(message) --&amp;gt; Hash message å¤„ç†åŠ å…¥ä¸€ä¸ªéšæœºæ•°ï¼Œç„¶åå¾—å‡ºç»“æœ(åŠ ç›); å¯ä»¥æœ‰æ•ˆç¼“è§£åœ¨è¾“å…¥å€¼æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é›†åˆï¼Œå“ˆå¸Œå€¼ä¹Ÿæ˜¯å›ºå®šé•¿åº¦è¢«åˆ«äººâ€˜è¯•â€™å‡ºæ¥çš„å‡ ç‡
1message --&amp;gt; H(R|message) --&amp;gt; Hash message 1.3 æ•°å­—è¯ä¹¦ 1.3.1 æ•°å­—ç­¾å æ•°å­—ç­¾åï¼›æŠŠæ•°æ®æ ¹æ®ç§é’¥/å“ˆå¸Œè¿›è¡ŒåŠ å¯†ï¼Œç„¶åå¿…é¡»è¦å¯¹åº”çš„å…¬é’¥æ¥è¿›è¡Œè§£å¯†è®¤è¯æ‰èƒ½ç¡®ä¿æ•°æ®å®‰å…¨ã€‚å‰åŠå¥çš„åŠ å¯†è¿‡ç¨‹å°±å«åš &#39;æ•°å­—ç­¾å&#39;
1.3.2 æ•°å­—è¯ä¹¦è®¤è¯è¿‡ç¨‹ Alice æƒ³è¦é€šè¿‡è¯ä¹¦åŠ å¯†è®© Bob å®‰å…¨è¯»åˆ°è‡ªå·±çš„ä¿¡æ¯æµç¨‹å¦‚ä¸‹ï¼š
Alice åœ¨æœ¬åœ°ç”Ÿæˆ Private Key å’Œ CSRï¼ˆCertificate Signing Requestï¼‰ã€‚CSR ä¸­åŒ…å«äº† Alice çš„å…¬é’¥å’Œå§“åï¼Œæœºæ„ã€åœ°å€ç­‰èº«ä»½ä¿¡æ¯ã€‚ Alice ä½¿ç”¨è¯¥ CSR å‘è¯ä¹¦æœºæ„å‘èµ·æ•°å­—è¯ä¹¦ç”³è¯·ã€‚ è¯ä¹¦æœºæ„éªŒè¯ Alice çš„èº«ä»½åï¼Œä½¿ç”¨ CSR ä¸­çš„ä¿¡æ¯ç”Ÿæˆæ•°å­—è¯ä¹¦ï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ CA æ ¹è¯ä¹¦å¯¹åº”çš„ç§é’¥å¯¹è¯¥è¯ä¹¦ç­¾åã€‚ Alice ä½¿ç”¨è‡ªå·±çš„ Private Key å¯¹åˆåŒè¿›è¡Œç­¾åï¼Œç„¶åå°†ç­¾ååçš„åˆåŒå’Œè‡ªå·±çš„è¯ä¹¦ä¸€èµ·å¹¶å‘é€ç»™ Bobã€‚ Bob ä½¿ç”¨æ“ä½œç³»ç»Ÿä¸­è‡ªå¸¦çš„è¯ä¹¦æœºæ„æ ¹è¯ä¹¦ä¸­çš„å…¬é’¥æ¥éªŒè¯ Alice è¯ä¹¦ä¸­çš„ç­¾åï¼Œä»¥ç¡®è®¤ Alice çš„èº«ä»½å’Œå…¬é’¥ã€‚(ä½¿ç”¨å†…ç½®æ ¹è¯ä¹¦ç¡®è®¤èº«ä»½å¹¶è·å–Aliceè¯ä¹¦) Alice çš„è¯ä¹¦éªŒè¯æˆåŠŸåï¼ŒBob ä½¿ç”¨ Alice è¯ä¹¦ä¸­çš„å…¬é’¥æ¥éªŒè¯åˆåŒä¸­æ•°å­—ç­¾åã€‚(ä½¿ç”¨åˆšåˆšè·å–çš„Aliceè¯ä¹¦(å…¬é’¥)è§£æAliceå‘é€çš„å†…å®¹) åˆåŒæ•°å­—ç­¾åé€šè¿‡éªŒè¯ï¼Œå¯ä»¥è¯æ˜è¯¥åˆåŒä¸º Alice æœ¬äººå‘é€ï¼Œå¹¶ä¸”ä¸­é—´æœªè¢«ç¬¬ä¸‰æ–¹ç¯¡æ”¹è¿‡ã€‚ æ³¨æ„ï¼š
          
          
        
      </description>
    </item>
    
    <item>
      <title>æµ…è°ˆkubernetes ingressæœºåˆ¶</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/ingress-mechanism/</link>
      <pubDate>Thu, 25 Aug 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/ingress-mechanism/</guid>
      <description>
        
          
            ingressåœ¨å°†æµé‡å‘å¾€åç«¯çš„æ—¶å€™æ˜¯ä¸ç»è¿‡kube-proxyçš„ï¼Œingress controllerä¼šç›´æ¥å’Œkube-apiserverè¿›è¡Œäº¤äº’ï¼Œç„¶åè·å–pod endpointså’Œserviceçš„å¯¹åº”å…³ç³»ï¼Œè¿›è¡Œè½®è¯¢ï¼Œè´Ÿè½½å‡è¡¡åˆ°åç«¯èŠ‚ç‚¹ã€‚
ä¸€ã€éªŒè¯è¯•éªŒ ä»é›†ç¾¤ä¸­åˆ é™¤kube-proxyï¼ŒæŸ¥çœ‹é€šè¿‡ingressçš„æ–¹å¼æ˜¯å¦å¯ä»¥è®¿é—®æˆåŠŸ?
1# å®éªŒä¸­é€‰æ‹©çš„æ˜¯&amp;#34;iptablesæ¨¡å¼çš„kube-proxy&amp;#34; 2# é¦–å…ˆå…³é—­kube-proxy 3$ sudo systemctl stop kube-proxy 4 5# æŸ¥çœ‹æœåŠ¡ï¼ŒClusterIPçš„ç«¯å£æ˜¯8080ï¼ŒNodePortçš„ç«¯å£æ˜¯30948 6$ ks 7NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE 8example-test NodePort 10.0.0.226 &amp;lt;none&amp;gt; 8080:30948/TCP 18h 9traefik NodePort 10.0.0.85 &amp;lt;none&amp;gt; 9000:30001/TCP,80:30002/TCP,443:31990/TCP 19h 10 11# æŸ¥çœ‹ä¸&amp;#34;10.0.0.226&amp;#34;æœ‰å…³çš„iptablesæ¡ç›®ï¼Œå¾—çŸ¥è®¿é—®&amp;#34;10.0.0.226&amp;#34;ä¸”ç›®çš„ç«¯å£æ˜¯&amp;#34;8080&amp;#34;çš„æµé‡ä¼šå‘é€ç»™KUBE-SVC-KNYNFDNL67C7KAZZé“¾ 12$ sudo iptables -S -t nat | grep 10.0.0.226 13-A KUBE-SERVICES ! -s 10.0.0.0/24 -d 10.0.0.226/32 -p tcp -m comment --comment &amp;#34;traffic-dispatcher/example-test:port-8080 cluster IP&amp;#34; -m tcp --dport 8080 -j KUBE-MARK-MASQ 14-A KUBE-SERVICES -d 10.
          
          
        
      </description>
    </item>
    
    <item>
      <title>client-go watchæ¥å£éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨é€€å‡ºæ€ä¹ˆåŠï¼Ÿ</title>
      <link>https://zhangsiming-blyq.github.io/post/golang/retrywatcher/</link>
      <pubDate>Sat, 28 May 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/golang/retrywatcher/</guid>
      <description>
        
          
            åœ¨ä½¿ç”¨client-goçš„watchæ¥å£æ—¶å€™ç¢°åˆ°å¼‚å¸¸é€€å‡ºé—®é¢˜ï¼ŒæŸ¥äº†ä¸€ä¸‹googleæ²¡æœ‰å¤šå°‘ä¿¡æ¯ï¼Œäºæ˜¯æ‰’äº†ä¸€ä¸‹ä»£ç ï¼ŒæŠŠè‡ªå·±è¸©çš„å‘è®°å½•ä¸‹æ¥æ–¹ä¾¿ä»¥åè‡ªæŸ¥è‡ªçº ã€‚
ä½¿ç”¨client-go watchæ¥å£ ğŸ’¡ å…¨å±€çš„myclusteréƒ½ç­‰äº*kubernetes.Clientset 1. å¦‚ä½•watch ç”±äºkubernetesæ•´åˆäº†etcdçš„watchåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡watchæ“ä½œå»å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ï¼Œä¸æ–­çš„æ¥æ”¶æ•°æ®ï¼›è¿™ç§æ–¹å¼è¦ä¼˜äºæ™®é€šçš„åå¤è½®è¯¢è¯·æ±‚ï¼Œé™ä½serverç«¯çš„å‹åŠ›;
ä½¿ç”¨client-goè°ƒç”¨å¯¹åº”å¯¹è±¡çš„Watch()æ–¹æ³•ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªwatch.Eventå¯¹è±¡ï¼Œå¯ä»¥å¯¹å…¶ä½¿ç”¨ResultChan()æ¥å—watchåˆ°çš„å¯¹è±¡ã€‚
1pod, err := mycluster.Clusterclientset.CoreV1().Pods(appNamespace).Watch(context.TODO(), metav1.ListOptions{LabelSelector: label}) 2if err != nil { 3 log.Error(err) 4} 5... 6event, ok := &amp;lt;-pod.ResultChan() 7if !ok { 8 log.Error(err) 9} å¼‚å¸¸ï¼šwatchæ¥å£è‡ªåŠ¨æ–­å¼€ 1. ç°è±¡ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œwatchæ“ä½œæŒç»­ä¸€æ®µæ—¶é—´å°±ä¼šè‡ªåŠ¨æ–­å¼€
2. æ’æŸ¥ æˆ‘ä»¬è¿›å…¥watchåŒ…é‡Œé¢æ‰¾åˆ°streamwatcher.goï¼Œå…¶ä¸­èŠ‚é€‰äº†ä¸€äº›é‡è¦ç‰‡æ®µï¼š
1type StreamWatcher struct { 2	sync.Mutex 3	source Decoder 4	reporter Reporter 5	result chan Event 6	stopped bool 7} 8... 9func NewStreamWatcher(d Decoder, r Reporter) *StreamWatcher { 10	sw := &amp;amp;StreamWatcher{ 11	source: d, 12	reporter: r, 13	// It&amp;#39;s easy for a consumer to add buffering via an extra 14	// goroutine/channel, but impossible for them to remove it, 15	// so nonbuffered is better.
          
          
        
      </description>
    </item>
    
    <item>
      <title>prometheus ç›‘æµ‹ kubernetes æ§åˆ¶å¹³é¢</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/monitor-control-plane/</link>
      <pubDate>Mon, 11 Apr 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/monitor-control-plane/</guid>
      <description>
        
          
            å¯¹äº kubernetes é›†ç¾¤çš„æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œç›‘æ§æ˜¯å¿…è¦çš„, ä»–å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å–åˆ°é›†ç¾¤çš„æ•´ä½“è´Ÿè½½å‹åŠ›ï¼Œå¹¶åœ¨æ ¸å¿ƒç»„ä»¶å‡ºé—®é¢˜çš„æ—¶å€™é…åˆå‘Šè­¦è®©ç®¡ç†å‘˜åŠæ—¶å‘ç°é—®é¢˜ï¼ŒåŠæ—¶å¤„ç†ï¼Œæ›´ç¨³å®šçš„ä¿è¯é›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸã€‚
ä¸€ã€Prometheus å¦‚ä½•è‡ªåŠ¨å‘ç° Kubernetes Metrics æ¥å£? prometheus æ”¶é›† kubernetes é›†ç¾¤ä¸­çš„æŒ‡æ ‡æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ crd(servicemonitors.monitoring.coreos.com)çš„æ–¹å¼ï¼Œä¸»è¦é€šè¿‡æ ‡ç­¾åŒ¹é…ï¼›å¦ä¸€ç§æ˜¯é€šè¿‡ scrape_configï¼Œæ”¯æŒæ ¹æ®é…ç½®å¥½çš„&amp;quot;relabel_configs&amp;quot;ä¸­çš„å…·ä½“ç›®æ ‡, è¿›è¡Œä¸æ–­æ‹‰å–(æ‹‰å–é—´éš”ä¸º&amp;quot;scrape_interval&amp;quot;)
é…ç½®æƒé™ï¼š k8s ä¸­ RBAC æ”¯æŒæˆæƒèµ„æºå¯¹è±¡çš„æƒé™ï¼Œæ¯”å¦‚å¯ä»¥ getã€listã€watch é›†ç¾¤ä¸­çš„ podï¼Œè¿˜æ”¯æŒç›´æ¥èµ‹äºˆå¯¹è±¡è®¿é—® api è·¯å¾„çš„æƒé™ï¼Œæ¯”å¦‚è·å–/healthz, /api ç­‰, å®˜æ–¹å¯¹äº non_resource_urls çš„è§£é‡Šå¦‚ä¸‹ï¼š
non_resource_urls - (Optional) NonResourceURLs is a set of partial urls that a user should have access to. *s are allowed, but only as the full, final step in the path Since non-resource URLs are not namespaced, this field is only applicable for ClusterRoles referenced from a ClusterRoleBinding.
          
          
        
      </description>
    </item>
    
    <item>
      <title>æµ…è°ˆ containerd</title>
      <link>https://zhangsiming-blyq.github.io/post/kubernetes/containerd/</link>
      <pubDate>Sun, 10 Apr 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/post/kubernetes/containerd/</guid>
      <description>
        
          
            ä¼´éšç€kuberneteså¯¹dockerçš„å¼ƒç”¨ï¼Œcontainerdå¼€å§‹è¿›å…¥å¤§ä¼—è§†é‡ï¼›ç›¸æ¯”äºkubeletä¸­é›†æˆdocker-shimè¿æ¥dockerï¼Œdockerå†æ¬¡æ¡ç”¨containerdå»ç®¡ç†å®¹å™¨ï¼Œç›´æ¥ä½¿ç”¨containerdå¯ä»¥é€šè¿‡åŸç”ŸCRIæ¥å£çš„è°ƒç”¨å®ç°å®¹å™¨runtimeï¼Œç®€åŒ–äº†è°ƒç”¨é“¾è·¯ï¼Œæ›´åŠ çš„çµæ´»å¯é ã€‚
ä¸€ã€å®‰è£…ä½¿ç”¨ ctr ç®¡ç† containerd 1# Install Dependent Libraries 2$ sudo apt-get update 3$ sudo apt-get install libseccomp2 4 5# ä¸‹è½½ 6# ç›®å‰æ˜¯ä¸‹è½½çš„1.5.2 7$ wget https://github.com/containerd/containerd/releases/download/v${VERSION}/cri-containerd-cni-${VERSION}-linux-amd64.tar.gz 8 9# å®‰è£… 10$ sudo tar --no-overwrite-dir -C / -xzf cri-containerd-cni-${VERSION}-linux-amd64.tar.gz 11# åˆå§‹åŒ–containerdé…ç½® 12$ containerd config default &amp;gt; /etc/containerd/config.toml 13# ä¿®æ”¹é»˜è®¤çš„sandbox_image 14$ vim /etc/containerd/config.toml 15... 16sandbox_image = &amp;#34;registry.cn-beijing.aliyuncs.com/shannonai-k8s/pause:3.1&amp;#34; 17... 18 19# å¯åŠ¨æœåŠ¡ 20sudo systemctl daemon-reload 21sudo systemctl start containerd 22 23# æŸ¥çœ‹ç‰ˆæœ¬ 24$ ctr version 25Client: 26 Version: 1.
          
          
        
      </description>
    </item>
    
  </channel>
</rss>
