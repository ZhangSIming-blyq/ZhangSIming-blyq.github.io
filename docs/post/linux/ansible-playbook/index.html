
<!DOCTYPE html>
<html
  lang="en"
  data-figures=""
  
    class="page"
  
  
  >
  <head>
<title>ansible-playbook 详解 | </title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<script async src="https://www.googletagmanager.com/gtag/js?id=XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'XXXXXXXXXX');
</script>



  
<meta property="og:locale" content="en" />

<meta property="og:type" content="article">
<meta name="description" content="Ansible 是一个开源的基于 OpenSSH 的自动化配置管理工具。可以用它来配置系统、部署软件和编排更高级的 IT 任务，比如持续部署或零停机更新。
一、ansible 简介 Ansible 的主要目标是简单和易用，并且它还高度关注安全性和可靠性。基于这样的目标，Ansible 适用于开发人员、系统管理员、发布工 …" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:creator" content="@janedoe">
<meta name="twitter:title" content="ansible-playbook 详解" />
<meta name="twitter:image" content="https://zhangsiming-blyq.github.io/images/thumbnail.png"/>
<meta property="og:url" content="https://zhangsiming-blyq.github.io/post/linux/ansible-playbook/" />
<meta property="og:title" content="ansible-playbook 详解" />
<meta property="og:description" content="Ansible 是一个开源的基于 OpenSSH 的自动化配置管理工具。可以用它来配置系统、部署软件和编排更高级的 IT 任务，比如持续部署或零停机更新。
一、ansible 简介 Ansible 的主要目标是简单和易用，并且它还高度关注安全性和可靠性。基于这样的目标，Ansible 适用于开发人员、系统管理员、发布工 …" />
<meta property="og:image" content="https://zhangsiming-blyq.github.io/images/thumbnail.png" />

<link rel="apple-touch-icon" sizes="180x180" href="https://zhangsiming-blyq.github.io/icons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zhangsiming-blyq.github.io/icons/favicon-32x32.png">
<link rel="manifest" href="https://zhangsiming-blyq.github.io/icons/site.webmanifest">

<link rel="canonical" href="https://zhangsiming-blyq.github.io/post/linux/ansible-playbook/">



<link rel="preload" href="https://zhangsiming-blyq.github.io/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity = "sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" as="style" crossorigin="anonymous">



<link rel="preload" href="https://zhangsiming-blyq.github.io/en/js/bundle.daf5d72d10b0f1e048706d4cb8d79d1ec41c3b5edcd83acfaa4df80252afff936252c1fa7804d8dcdb500eaf0f7d5adbb79cfe886cf7068f12f58cdebc05e1c3.js" as="script" integrity=
"sha512-2vXXLRCw8eBIcG1MuNedHsQcO17c2DrPqk34AlKv/5NiUsH6eATY3NtQDq8PfVrbt5z&#43;iGz3Bo8S9YzevAXhww==" crossorigin="anonymous">


<link rel="stylesheet" type="text/css" href="https://zhangsiming-blyq.github.io/css/styles.42e2c5f6d8cf9c52872666f8d8b2678ad0c426978b9d78aff3c33b7a1e7f6f97f54bcdaf0518a25fb0fe26367d04f8b07c683b3b38b331cb098daadee06b1f3e.css" integrity="sha512-QuLF9tjPnFKHJmb42LJnitDEJpeLnXiv88M7eh5/b5f1S82vBRiiX7D&#43;JjZ9BPiwfGg7OzizMcsJjare4GsfPg==" crossorigin="anonymous">


  </head>
  <body
    data-code="100000"
    data-lines="false"
    id="documentTop"
    data-lang="en"
  >

<header class="nav_header" >
  <nav class="nav"><a href='https://zhangsiming-blyq.github.io/' class="nav_brand nav_item" title="">
  <img src="https://zhangsiming-blyq.github.io/logos/bailiyingqi.png" class="logo" alt="">
  <div class="nav_close">
    <div><svg class="icon">
  <title>open-menu</title>
  <use xlink:href="#open-menu"></use>
</svg>
<svg class="icon">
  <title>closeme</title>
  <use xlink:href="#closeme"></use>
</svg>
</div>
  </div>
</a>

    <div class='nav_body nav_body_left'>
      
      
      
        

  <div class="nav_parent">
    <a href="https://zhangsiming-blyq.github.io/" class="nav_item" title="Home">Home </a>
  </div>
  <div class="nav_parent">
    <a href="https://zhangsiming-blyq.github.io/archives/" class="nav_item" title="Archives">Archives </a>
  </div>
  <div class="nav_parent">
    <a href="https://zhangsiming-blyq.github.io/about/" class="nav_item" title="About">About </a>
  </div>
      
      <div class="nav_parent">
        <a href="#" class="nav_item"></a>
        <div class="nav_sub">
          <span class="nav_child"></span>
          
          <a href="https://zhangsiming-blyq.github.io/" class="nav_child nav_item"></a>
          
          <a href="https://zhangsiming-blyq.github.io/zh-cn/" class="nav_child nav_item"></a>
          
        </div>
      </div>
<div class='follow'>
  <a href="https://www.instagram.com/zhangsiming_bailiyingqi/">
    <svg class="icon">
  <title>instagram</title>
  <use xlink:href="#instagram"></use>
</svg>

  </a>
  <a href="https://twitter.com/Siming78740702">
    <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

  </a>
  <a href="https://github.com/ZhangSIming-blyq">
    <svg class="icon">
  <title>github</title>
  <use xlink:href="#github"></use>
</svg>

  </a>
    
  <a href="https://zhangsiming-blyq.github.io/index.xml">
    <svg class="icon">
  <title>rss</title>
  <use xlink:href="#rss"></use>
</svg>

  </a>
<div class="color_mode">
  <input type="checkbox" class="color_choice" id="mode">
</div>

</div>

    </div>
  </nav>
</header>

    <main>
  
<div class="grid-inverse wrap content">
  <article class="post_content">
    <h1 class="post_title">ansible-playbook 详解</h1>
  <div class="post_meta">
    <span><svg class="icon">
  <title>calendar</title>
  <use xlink:href="#calendar"></use>
</svg>
</span>
    <span class="post_date">
      Jul 10, 2022</span>
    <span class="post_time"> · 6 min read</span><span>&nbsp;· <a href='https://zhangsiming-blyq.github.io/tags/ansible/' title="ansible" class="post_tag button button_translucent">ansible
        </a><a href='https://zhangsiming-blyq.github.io/tags/linux/' title="linux" class="post_tag button button_translucent">linux
        </a><a href='https://zhangsiming-blyq.github.io/tags/%E4%B8%AD%E6%96%87/' title="中文" class="post_tag button button_translucent">中文
        </a>
    </span>
    <span class="page_only">&nbsp;·
  <div class="post_share">
    Share on:
    <a href="https://twitter.com/intent/tweet?text=ansible-playbook%20%e8%af%a6%e8%a7%a3&url=https%3a%2f%2fzhangsiming-blyq.github.io%2fpost%2flinux%2fansible-playbook%2f&tw_p=tweetbutton" class="twitter" title="Share on Twitter" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>twitter</title>
  <use xlink:href="#twitter"></use>
</svg>

    </a>
    <a href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fzhangsiming-blyq.github.io%2fpost%2flinux%2fansible-playbook%2f&t=ansible-playbook%20%e8%af%a6%e8%a7%a3" class="facebook" title="Share on Facebook" target="_blank" rel="nofollow">
      <svg class="icon">
  <title>facebook</title>
  <use xlink:href="#facebook"></use>
</svg>

    </a>
    <a href="#linkedinshare" id = "linkedinshare" class="linkedin" title="Share on LinkedIn" rel="nofollow">
      <svg class="icon">
  <title>linkedin</title>
  <use xlink:href="#linkedin"></use>
</svg>

    </a>
    <a href="https://zhangsiming-blyq.github.io/post/linux/ansible-playbook/" title="Copy Link" class="link link_yank">
      <svg class="icon">
  <title>copy</title>
  <use xlink:href="#copy"></use>
</svg>

    </a>
  </div>
  </span>
  </div>

      <div class="post_toc">
        <h2>Overview</h2>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#一ansible-简介">一、ansible 简介</a>
      <ul>
        <li><a href="#11-ansible-变量优先级如下">1.1 ansible 变量优先级如下</a></li>
        <li><a href="#12-变量的作用范围scoping-variables">1.2 变量的作用范围(Scoping variables)</a></li>
        <li><a href="#13-ansible-目录结构最佳实践">1.3 ansible 目录结构最佳实践</a></li>
        <li><a href="#14-ansible-playbook-roles-初始化行为规划">1.4 ansible-playbook roles 初始化行为规划</a></li>
        <li><a href="#15-ansible-playbook-执行顺序">1.5 ansible-playbook 执行顺序</a></li>
      </ul>
    </li>
    <li><a href="#二kubespray-部署集群-playbook-解读">二、kubespray 部署集群 playbook 解读</a>
      <ul>
        <li><a href="#12-实际操作使用-ansible-playbook-部署单节点集群">1.2 实际操作使用 ansible-playbook 部署单节点集群</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
    <div class="post_body"><blockquote>
<p>Ansible 是一个开源的基于 OpenSSH 的<strong>自动化配置管理工具</strong>。可以用它来配置系统、部署软件和编排更高级的 IT 任务，比如持续部署或零停机更新。</p>
</blockquote>
<h2 id="一ansible-简介">一、ansible 简介</h2>
<blockquote>
<p>Ansible 的主要目标是简单和易用，并且它还高度关注安全性和可靠性。基于这样的目标，Ansible 适用于开发人员、系统管理员、发布工程师、IT 经理，以及介于两者之间的所有人。Ansible <strong>适合管理几乎所有的环境，从拥有少数实例的小型环境到有数千个实例的企业环境</strong>。</p>
</blockquote>
<h3 id="11-ansible-变量优先级如下">1.1 ansible 变量优先级如下</h3>
<ol>
<li>command line values (eg &quot;-u user&quot;)</li>
<li>role defaults</li>
<li>inventory file or script group vars</li>
<li>inventory group_vars/all</li>
<li>playbook group_vars/all</li>
<li>inventory group_vars/*</li>
<li>playbook group_vars/*</li>
<li>inventory file or script host vars</li>
<li>inventory host_vars/*: inventory 下面的 hosts_vars 目录下的变量优先级大于 group_vars 目录下的</li>
<li>playbook host_vars/*</li>
<li>host facts / cached set_facts</li>
<li>play vars</li>
<li>play vars_prompt</li>
<li>play vars_files: vars_files 优先级大于同级别的 vars 字段(play 内定义)</li>
<li>role vars (defined in role/vars/main.yml): role 里面的 vars 目录下的定义变量</li>
<li>block vars (only for tasks in block)</li>
<li>task vars (only for the task): task 里面的 vars 字段优先级别比较高(本 task)</li>
<li>include_vars</li>
<li>set_facts / registered vars: 比较常用 set_facts 更改一些后面要使用的变量，全局生效；registered vars 一般连续的 task 用的比较多</li>
<li>role (and include_role) params</li>
<li>include params</li>
<li>extra vars (always win precedence): 执行 ansible-playbook 命令时候传入的 extra vars 级别最高，高于一切</li>
</ol>
<h3 id="12-变量的作用范围scoping-variables">1.2 变量的作用范围(Scoping variables)</h3>
<ol>
<li>Global: this is set by config, environment variables and the command line</li>
<li>Play: each play and contained structures, vars entries (vars; vars_files; vars_prompt), role defaults and vars.</li>
<li>Host: variables directly associated to a host, like inventory, include_vars, facts or registered task outputs</li>
</ol>
<blockquote>
<p>Ansible 1.2 及以上的版本中,group_vars/ 和 host_vars/ 目錄可放在 inventory 目錄下,或是 playbook 目錄下. 如果兩個目錄下都存在,那麼 playbook 目錄下的配置會覆蓋 inventory 目錄的配置(对应解释上分 4-10 条变量优先级)</p>
</blockquote>
<h3 id="13-ansible-目录结构最佳实践">1.3 ansible 目录结构最佳实践</h3>
<ul>
<li>结构如下：</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">├── playbooks.yml
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">├── inventory<span class="o">(</span>inventory下可以任意加子目录进行分组<span class="o">)</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="p">|</span>   ├── group_vars ├── all ├── *.yml
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">|</span>   <span class="p">|</span>              ├── *.yml
</span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="p">|</span>   <span class="p">|</span>              └── *
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="p">|</span>   ├── host_vars
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">|</span>   <span class="p">|</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">│   └── hosts.ini
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="p">|</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">├── roles
</span></span><span class="line"><span class="ln">11</span><span class="cl">│   ├── common
</span></span><span class="line"><span class="ln">12</span><span class="cl">│   │   ├── files
</span></span><span class="line"><span class="ln">13</span><span class="cl">│   │   ├── handlers
</span></span><span class="line"><span class="ln">14</span><span class="cl">│   │   ├── meta
</span></span><span class="line"><span class="ln">15</span><span class="cl">│   │   ├── templates
</span></span><span class="line"><span class="ln">16</span><span class="cl">│   │   ├── tasks
</span></span><span class="line"><span class="ln">17</span><span class="cl">│   │   │   └── main.yml
</span></span><span class="line"><span class="ln">18</span><span class="cl">│   │   └── vars
</span></span><span class="line"><span class="ln">19</span><span class="cl"><span class="p">|</span>   <span class="p">|</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">│   ├── others
</span></span><span class="line"><span class="ln">21</span><span class="cl">│       ├── files
</span></span><span class="line"><span class="ln">22</span><span class="cl">│       ├── handlers
</span></span><span class="line"><span class="ln">23</span><span class="cl">│       ├── meta
</span></span><span class="line"><span class="ln">24</span><span class="cl">│       ├── templates
</span></span><span class="line"><span class="ln">25</span><span class="cl">│       ├── tasks
</span></span><span class="line"><span class="ln">26</span><span class="cl">│       │   └── main.yml
</span></span><span class="line"><span class="ln">27</span><span class="cl">│       └── vars
</span></span><span class="line"><span class="ln">28</span><span class="cl">└── *.yml
</span></span></code></pre></div><ol>
<li>使用 roles 管理不同的安装模块</li>
<li>使用 inventory/host.ini 管理操作主机，对不同主机进行分组</li>
<li>使用 group_vars 管理基本的默认变量，playbook 中使用 set_facts 设置需要的变量，默认不想被修改的变量写在 roles/vars/main.yml</li>
<li>每个 task 都要写 name</li>
<li>tags 写在 role 阶段</li>
</ol>
<h3 id="14-ansible-playbook-roles-初始化行为规划">1.4 ansible-playbook roles 初始化行为规划</h3>
<ol>
<li>如果角色 /xxx/tasks/main.yaml 存在，则其中列出的任务将添加到任务中，否则将不会添加任务中</li>
<li>如果角色 /xxx/handlers/main.yaml 存在，则其中列出的处理程序将添加到任务中，否则将不会添加任务中</li>
<li>如果角色 /xxx/vars/main.yml 存在，则其中列出的处理程序将添加到任务中，否则将不会添加任务中</li>
<li>如果角色 /xxx/defaults/main.yml 存在，则其中列出的处理程序将添加到任务中，否则将不会添加任务中</li>
<li>如果角色 /xxx/meta/main.yml 存在，则其中列出的任何角色依赖项将添加到角色列表（1.3 及更高版本）</li>
<li>任何副本，脚本，模板或包含任务（在角色中）都可以引用 roles / x / {files，templates，tasks} /（dir 取决于任务）中的文件，而无需相对或绝对地路径化它们</li>
</ol>
<h3 id="15-ansible-playbook-执行顺序">1.5 ansible-playbook 执行顺序</h3>
<ol>
<li>pre_tasks 游戏中定义的任何内容</li>
<li>列出的每个角色将依次执行。将首先运行角色中定义的任何角色依赖项，但需遵循标记过滤和条件。roles meta/main.yml</li>
<li>tasks 游戏中定义的任何内容</li>
<li>post_tasks 游戏中定义的任何内容</li>
</ol>
<h2 id="二kubespray-部署集群-playbook-解读">二、kubespray 部署集群 playbook 解读</h2>
<p>github 地址：https://github.com/kubernetes-sigs/kubespray</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln">  1</span><span class="cl">$ gc https://github.com/kubernetes-sigs/kubespray
</span></span><span class="line"><span class="ln">  2</span><span class="cl">$ <span class="nb">cd</span> kubespray
</span></span><span class="line"><span class="ln">  3</span><span class="cl">
</span></span><span class="line"><span class="ln">  4</span><span class="cl"><span class="c1"># 查看部署集群playbook</span>
</span></span><span class="line"><span class="ln">  5</span><span class="cl">$ cat cluster.yml
</span></span><span class="line"><span class="ln">  6</span><span class="cl">---
</span></span><span class="line"><span class="ln">  7</span><span class="cl"><span class="c1"># 检查ansible版本</span>
</span></span><span class="line"><span class="ln">  8</span><span class="cl">- name: Check ansible version
</span></span><span class="line"><span class="ln">  9</span><span class="cl">  import_playbook: ansible_version.yml
</span></span><span class="line"><span class="ln"> 10</span><span class="cl">
</span></span><span class="line"><span class="ln"> 11</span><span class="cl"><span class="c1"># 检查inventory中组的版本，进行适配旧版本的group名称</span>
</span></span><span class="line"><span class="ln"> 12</span><span class="cl">- name: Ensure compatibility with old groups
</span></span><span class="line"><span class="ln"> 13</span><span class="cl">  import_playbook: legacy_groups.yml
</span></span><span class="line"><span class="ln"> 14</span><span class="cl">
</span></span><span class="line"><span class="ln"> 15</span><span class="cl"><span class="c1"># 堡垒机配置(没有跳过)</span>
</span></span><span class="line"><span class="ln"> 16</span><span class="cl">- hosts: bastion<span class="o">[</span>0<span class="o">]</span>
</span></span><span class="line"><span class="ln"> 17</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 18</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 19</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 20</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 21</span><span class="cl">    - <span class="o">{</span> role: bastion-ssh-config, tags: <span class="o">[</span><span class="s2">&#34;localhost&#34;</span>, <span class="s2">&#34;bastion&#34;</span><span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 22</span><span class="cl">
</span></span><span class="line"><span class="ln"> 23</span><span class="cl"><span class="c1"># 默认linear,每个主机的单个task执行完成会等待其他都完成后再执行下个任务，设置free可不等待其他主机，继续往下执行(看起来会比较乱)</span>
</span></span><span class="line"><span class="ln"> 24</span><span class="cl"><span class="c1"># linear策略即线性执行策略，线性执行策略指主机组内所有主机完成一个任务后才继续下一个任务的执行，在执行一个任务时，如果某个主机先执行完则会等待其他主机执行结束。说直白点就是第一个任务在指定的主机都执行完，再进行第二个任务的执行，第二个任务在指定的主机都执行完后，再进行第三个任务的执行…… 以此类推。</span>
</span></span><span class="line"><span class="ln"> 25</span><span class="cl"><span class="c1"># free策略即自由策略，即在一个play执行完之前，每个主机都各顾各的尽可能快的完成play里的所有任务，而不会因为其他主机没执行完任务而等待，不受线性执行策略那样的约束。所以这种策略的执行结果给人感觉是无序的甚至是杂乱无章的，而且每次执行结果的task显示顺序很可能不一样</span>
</span></span><span class="line"><span class="ln"> 26</span><span class="cl">
</span></span><span class="line"><span class="ln"> 27</span><span class="cl"><span class="c1"># 此阶段对于etcd的每一个节点一个一个的进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact), bootstrap-os(装一些yum源，基础包，改一些主机名等操作)</span>
</span></span><span class="line"><span class="ln"> 28</span><span class="cl">- hosts: k8s_cluster:etcd
</span></span><span class="line"><span class="ln"> 29</span><span class="cl">  strategy: linear
</span></span><span class="line"><span class="ln"> 30</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 31</span><span class="cl">  gather_facts: <span class="nb">false</span>
</span></span><span class="line"><span class="ln"> 32</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 33</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 34</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 35</span><span class="cl">    - <span class="o">{</span> role: bootstrap-os, tags: bootstrap-os<span class="o">}</span>
</span></span><span class="line"><span class="ln"> 36</span><span class="cl">
</span></span><span class="line"><span class="ln"> 37</span><span class="cl">- name: Gather facts
</span></span><span class="line"><span class="ln"> 38</span><span class="cl">  tags: always
</span></span><span class="line"><span class="ln"> 39</span><span class="cl">  import_playbook: facts.yml
</span></span><span class="line"><span class="ln"> 40</span><span class="cl">
</span></span><span class="line"><span class="ln"> 41</span><span class="cl"><span class="c1"># 此阶段对于etcd的每一个节点一个一个的进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact)、kubernetes/preinstall(预先配置一些环境，比如禁用SWAP、配置替换resolvconf，设置一些cni的bin路径等、创建/检查一些安装目录、期间对于特定文件触发handler重启相关服务、配置systemd-resolved、修改/etc/hosts文件等)、container-engine(选择容器runtime，进行安装、配置、reload等)、</span>
</span></span><span class="line"><span class="ln"> 42</span><span class="cl"><span class="c1"># download(模块用于下载所有有需要的镜像，先在ansible执行机缓存，之后再下载所有需要的二进制包，包括kubeadm需要的、kubernetes集群需要的等等)</span>
</span></span><span class="line"><span class="ln"> 43</span><span class="cl">- hosts: k8s_cluster:etcd
</span></span><span class="line"><span class="ln"> 44</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 45</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 46</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 47</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 48</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 49</span><span class="cl">    - <span class="o">{</span> role: kubernetes/preinstall, tags: preinstall <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 50</span><span class="cl">    - <span class="o">{</span> role: <span class="s2">&#34;container-engine&#34;</span>, tags: <span class="s2">&#34;container-engine&#34;</span>, when: deploy_container_engine<span class="p">|</span>default<span class="o">(</span><span class="nb">true</span><span class="o">)</span> <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 51</span><span class="cl">    - <span class="o">{</span> role: download, tags: download, when: <span class="s2">&#34;not skip_downloads&#34;</span> <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 52</span><span class="cl">
</span></span><span class="line"><span class="ln"> 53</span><span class="cl"><span class="c1"># 此阶段开始执行etcd role，先进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact)、再进行etcd(检查、创建etcd证书，部署etcd集群，添加etcd节点，检查etcd状态，创建etcd执行用户等...)</span>
</span></span><span class="line"><span class="ln"> 54</span><span class="cl">- hosts: etcd
</span></span><span class="line"><span class="ln"> 55</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 56</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 57</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 58</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 59</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 60</span><span class="cl">    - role: etcd
</span></span><span class="line"><span class="ln"> 61</span><span class="cl">      tags: etcd
</span></span><span class="line"><span class="ln"> 62</span><span class="cl">      vars:
</span></span><span class="line"><span class="ln"> 63</span><span class="cl">        etcd_cluster_setup: <span class="nb">true</span>
</span></span><span class="line"><span class="ln"> 64</span><span class="cl">        etcd_events_cluster_setup: <span class="s2">&#34;{{ etcd_events_cluster_enabled }}&#34;</span>
</span></span><span class="line"><span class="ln"> 65</span><span class="cl">      when: not etcd_kubeadm_enabled<span class="p">|</span> default<span class="o">(</span><span class="nb">false</span><span class="o">)</span>
</span></span><span class="line"><span class="ln"> 66</span><span class="cl">
</span></span><span class="line"><span class="ln"> 67</span><span class="cl"><span class="c1"># 设置etcd_cluster_setup、etcd_events_cluster_setup为 false，主要是将k8s cluster中的机器，分发配置信息etcd的证书, 用于后续与etcd集群交互</span>
</span></span><span class="line"><span class="ln"> 68</span><span class="cl">- hosts: k8s_cluster
</span></span><span class="line"><span class="ln"> 69</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 70</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 71</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 72</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 73</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 74</span><span class="cl">    - role: etcd
</span></span><span class="line"><span class="ln"> 75</span><span class="cl">      tags: etcd
</span></span><span class="line"><span class="ln"> 76</span><span class="cl">      vars:
</span></span><span class="line"><span class="ln"> 77</span><span class="cl">        etcd_cluster_setup: <span class="nb">false</span>
</span></span><span class="line"><span class="ln"> 78</span><span class="cl">        etcd_events_cluster_setup: <span class="nb">false</span>
</span></span><span class="line"><span class="ln"> 79</span><span class="cl">      when: not etcd_kubeadm_enabled<span class="p">|</span> default<span class="o">(</span><span class="nb">false</span><span class="o">)</span>
</span></span><span class="line"><span class="ln"> 80</span><span class="cl">
</span></span><span class="line"><span class="ln"> 81</span><span class="cl"><span class="c1"># 此阶段执行kubernetes/nodes role，先进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact), 再进行kubernetes/node(检查docker cgroup, 配置一些参数等、拷贝一些数据，比如cni目录下的，等等、通过镜像挂载的方式配置安装kubelet、部署apiserver的负载均衡、确保预留nodePort端口范围，通过sysctl修改内核参数、确认kube-proxy ipvs需要的内核模块已开启)</span>
</span></span><span class="line"><span class="ln"> 82</span><span class="cl">- hosts: k8s_cluster
</span></span><span class="line"><span class="ln"> 83</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 84</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 85</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 86</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 87</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 88</span><span class="cl">    - <span class="o">{</span> role: kubernetes/node, tags: node <span class="o">}</span>
</span></span><span class="line"><span class="ln"> 89</span><span class="cl">
</span></span><span class="line"><span class="ln"> 90</span><span class="cl"><span class="c1"># 此阶段部署配置kube_control_plane机器，先进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact)、</span>
</span></span><span class="line"><span class="ln"> 91</span><span class="cl"><span class="c1"># kubernetes/control-plane(删除control-plane静态文件，删除旧的master容器、下载好kubectl命令行工具、配置kubectl命令行工具自动补全、在kubeadm-setup.yml初始化Initialize first master，创建kubeadm的24h token，然后include_tasks: kubeadm-secondary.yml添加其他的master到集群中、检查etcd证书过期时间等后续检查、更新apiserver客户端的连接地址为fix后的api负载均衡地址、renew集群的证书们, 使用kubeadm renew的方式)</span>
</span></span><span class="line"><span class="ln"> 92</span><span class="cl"><span class="c1"># kubernetes/client(建立/etc/kubernetes架构目录，拷贝kubeconfig到node并配置好ansible执行机上面的k8s client环境)</span>
</span></span><span class="line"><span class="ln"> 93</span><span class="cl"><span class="c1"># kubernetes-apps/cluster_roles(通过配置好的kubectl执行，Apply workaround to allow all nodes with cert O=system:nodes to register, 这样之后的所有node加入申请都会自动审批通过...)</span>
</span></span><span class="line"><span class="ln"> 94</span><span class="cl">- hosts: kube_control_plane
</span></span><span class="line"><span class="ln"> 95</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln"> 96</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln"> 97</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln"> 98</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln"> 99</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">100</span><span class="cl">    - <span class="o">{</span> role: kubernetes/control-plane, tags: master <span class="o">}</span>
</span></span><span class="line"><span class="ln">101</span><span class="cl">    - <span class="o">{</span> role: kubernetes/client, tags: client <span class="o">}</span>
</span></span><span class="line"><span class="ln">102</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/cluster_roles, tags: cluster-roles <span class="o">}</span>
</span></span><span class="line"><span class="ln">103</span><span class="cl">
</span></span><span class="line"><span class="ln">104</span><span class="cl"><span class="c1"># 此阶段部署配置cluster里面的其他普通node节点，先进行kubespray-defaults(设置一些fallback_ip、noproxy的set_fact)、</span>
</span></span><span class="line"><span class="ln">105</span><span class="cl"><span class="c1"># 之后kubernetes/kubeadm(检查kubelet配置文件是否存在、检查kubelet的ca.crt证书是否存在、创建kubeadm join的token、更新kubelet中的地址为负载均衡的apiserver地址、重启kube-proxy的pods)、</span>
</span></span><span class="line"><span class="ln">106</span><span class="cl"><span class="c1"># kubernetes/node-label(根据变量中的{{ role_node_labels + inventory_node_labels }}给node打上对应的标签，通过kubectl label nodes)</span>
</span></span><span class="line"><span class="ln">107</span><span class="cl"><span class="c1"># network_plugin(根据变量决定要部署哪种网络插件，举例cilium的话就是check.yml检查cilium参数，install.yml渲染安装cilium需要的yaml文件到node、apply.yml执行kubectl部署网络插件到集群中)</span>
</span></span><span class="line"><span class="ln">108</span><span class="cl">- hosts: k8s_cluster
</span></span><span class="line"><span class="ln">109</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln">110</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln">111</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln">112</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln">113</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">114</span><span class="cl">    - <span class="o">{</span> role: kubernetes/kubeadm, tags: kubeadm<span class="o">}</span>
</span></span><span class="line"><span class="ln">115</span><span class="cl">    - <span class="o">{</span> role: kubernetes/node-label, tags: node-label <span class="o">}</span>
</span></span><span class="line"><span class="ln">116</span><span class="cl">    - <span class="o">{</span> role: network_plugin, tags: network <span class="o">}</span>
</span></span><span class="line"><span class="ln">117</span><span class="cl">
</span></span><span class="line"><span class="ln">118</span><span class="cl"><span class="c1"># 如果网络插件部署的是calico，还需要到宿主机上面执行一些操作，这里我们选择cilium就跳过了</span>
</span></span><span class="line"><span class="ln">119</span><span class="cl">- hosts: calico_rr
</span></span><span class="line"><span class="ln">120</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln">121</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln">122</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln">123</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln">124</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">125</span><span class="cl">    - <span class="o">{</span> role: network_plugin/calico/rr, tags: <span class="o">[</span><span class="s1">&#39;network&#39;</span>, <span class="s1">&#39;calico_rr&#39;</span><span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="ln">126</span><span class="cl">
</span></span><span class="line"><span class="ln">127</span><span class="cl"><span class="c1"># windows master的额外配置，这里跳过, 一般不用</span>
</span></span><span class="line"><span class="ln">128</span><span class="cl">- hosts: kube_control_plane<span class="o">[</span>0<span class="o">]</span>
</span></span><span class="line"><span class="ln">129</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln">130</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln">131</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln">132</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln">133</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">134</span><span class="cl">    - <span class="o">{</span> role: win_nodes/kubernetes_patch, tags: <span class="o">[</span><span class="s2">&#34;master&#34;</span>, <span class="s2">&#34;win_nodes&#34;</span><span class="o">]</span> <span class="o">}</span>
</span></span><span class="line"><span class="ln">135</span><span class="cl">
</span></span><span class="line"><span class="ln">136</span><span class="cl"><span class="c1"># 这阶段就是在kube_control_plane也就是有权限kubectl的机器上面安装后续应用了，不是每个role都需要走，比如是否部署ingress_controller就由&#34;ingress_nginx_enabled&#34;管理，kubernetes-apps下有个meta/main.yml文件，根据参数选择安装不同的app，流程无非就是下载包，或者传输yaml文件之后kubectl apply</span>
</span></span><span class="line"><span class="ln">137</span><span class="cl">- hosts: kube_control_plane
</span></span><span class="line"><span class="ln">138</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln">139</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln">140</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln">141</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln">142</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">143</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/external_cloud_controller, tags: external-cloud-controller <span class="o">}</span>
</span></span><span class="line"><span class="ln">144</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/network_plugin, tags: network <span class="o">}</span>
</span></span><span class="line"><span class="ln">145</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/policy_controller, tags: policy-controller <span class="o">}</span>
</span></span><span class="line"><span class="ln">146</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/ingress_controller, tags: ingress-controller <span class="o">}</span>
</span></span><span class="line"><span class="ln">147</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps/external_provisioner, tags: external-provisioner <span class="o">}</span>
</span></span><span class="line"><span class="ln">148</span><span class="cl">    - <span class="o">{</span> role: kubernetes-apps, tags: apps <span class="o">}</span>
</span></span><span class="line"><span class="ln">149</span><span class="cl">
</span></span><span class="line"><span class="ln">150</span><span class="cl"><span class="c1"># 这阶段是最后收尾阶段完善集群的dns，host文件，resolv文件里面的格式化对应项等, 至此kubernetes集群通过ansible kubespray安装完毕</span>
</span></span><span class="line"><span class="ln">151</span><span class="cl">- hosts: k8s_cluster
</span></span><span class="line"><span class="ln">152</span><span class="cl">  gather_facts: False
</span></span><span class="line"><span class="ln">153</span><span class="cl">  any_errors_fatal: <span class="s2">&#34;{{ any_errors_fatal | default(true) }}&#34;</span>
</span></span><span class="line"><span class="ln">154</span><span class="cl">  environment: <span class="s2">&#34;{{ proxy_disable_env }}&#34;</span>
</span></span><span class="line"><span class="ln">155</span><span class="cl">  roles:
</span></span><span class="line"><span class="ln">156</span><span class="cl">    - <span class="o">{</span> role: kubespray-defaults <span class="o">}</span>
</span></span><span class="line"><span class="ln">157</span><span class="cl">    - <span class="o">{</span> role: kubernetes/preinstall, when: <span class="s2">&#34;dns_mode != &#39;none&#39; and resolvconf_mode == &#39;host_resolvconf&#39;&#34;</span>, tags: resolvconf, dns_late: <span class="nb">true</span> <span class="o">}</span>
</span></span></code></pre></div><h3 id="12-实际操作使用-ansible-playbook-部署单节点集群">1.2 实际操作使用 ansible-playbook 部署单节点集群</h3>
<p>部署参考文档：https://kubespray.io/#/、https://kubespray.io/#/docs/downloads</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="ln"> 1</span><span class="cl">$ sudo apt-get install python3-pip
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">$ <span class="nb">cd</span> kubespray
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">$ sudo pip3 install -r requirements.txt
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="c1"># 看下面两个文件有没有要删除的东西</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">$ vim inventory/mycluster/group_vars/all/all.yml
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">$ vim inventory/mycluster/group_vars/k8s_cluster/k8s-cluster.yml
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="c1"># download缓存相关配置可以查看链接：https://kubespray.io/#/docs/downloads</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="c1"># 配置免密sudo，配置免密ssh节点</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">$ vim /etc/sudoers
</span></span><span class="line"><span class="ln">10</span><span class="cl">vagrant <span class="nv">ALL</span><span class="o">=</span>NOPASSWD:ALL
</span></span><span class="line"><span class="ln">11</span><span class="cl">
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="c1"># 开始部署集群</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl">$ ansible-playbook -i inventory/k8sdemo/inventory.ini  --become --become-user<span class="o">=</span>root cluster.yml
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="c1"># 部署结果无报错</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">...
</span></span><span class="line"><span class="ln">16</span><span class="cl">PLAY RECAP *******************************************************************************************************************************************************
</span></span><span class="line"><span class="ln">17</span><span class="cl">localhost                  : <span class="nv">ok</span><span class="o">=</span><span class="m">4</span>    <span class="nv">changed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">skipped</span><span class="o">=</span><span class="m">0</span>    <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>    <span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">node1                      : <span class="nv">ok</span><span class="o">=</span><span class="m">650</span>  <span class="nv">changed</span><span class="o">=</span><span class="m">177</span>  <span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span>    <span class="nv">failed</span><span class="o">=</span><span class="m">0</span>    <span class="nv">skipped</span><span class="o">=</span><span class="m">1031</span> <span class="nv">rescued</span><span class="o">=</span><span class="m">0</span>    <span class="nv">ignored</span><span class="o">=</span><span class="m">2</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">...
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="c1"># 查看集群状态</span>
</span></span><span class="line"><span class="ln">21</span><span class="cl">$ kubectl get nodes
</span></span><span class="line"><span class="ln">22</span><span class="cl">NAME    STATUS   ROLES                  AGE     VERSION
</span></span><span class="line"><span class="ln">23</span><span class="cl">node1   Ready    control-plane,master   3m49s   v1.22.2
</span></span><span class="line"><span class="ln">24</span><span class="cl">$ kubectl get cs
</span></span><span class="line"><span class="ln">25</span><span class="cl">Warning: v1 ComponentStatus is deprecated in v1.19+
</span></span><span class="line"><span class="ln">26</span><span class="cl">NAME                 STATUS    MESSAGE             ERROR
</span></span><span class="line"><span class="ln">27</span><span class="cl">scheduler            Healthy   ok
</span></span><span class="line"><span class="ln">28</span><span class="cl">controller-manager   Healthy   ok
</span></span><span class="line"><span class="ln">29</span><span class="cl">etcd-0               Healthy   <span class="o">{</span><span class="s2">&#34;health&#34;</span>:<span class="s2">&#34;true&#34;</span><span class="o">}</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">$ kubectl get pods -A
</span></span><span class="line"><span class="ln">31</span><span class="cl">NAMESPACE     NAME                              READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="ln">32</span><span class="cl">kube-system   cilium-dtgnn                      1/1     Running   <span class="m">0</span>          3m16s
</span></span><span class="line"><span class="ln">33</span><span class="cl">kube-system   cilium-operator-66576fd87-bklpc   1/1     Running   <span class="m">0</span>          3m15s
</span></span><span class="line"><span class="ln">34</span><span class="cl">kube-system   coredns-8474476ff8-85qkx          1/1     Running   <span class="m">0</span>          3m9s
</span></span><span class="line"><span class="ln">35</span><span class="cl">kube-system   coredns-8474476ff8-xtmst          0/1     Pending   <span class="m">0</span>          2m45s
</span></span><span class="line"><span class="ln">36</span><span class="cl">kube-system   dns-autoscaler-7df78bfcfb-gsqjb   1/1     Running   <span class="m">0</span>          3m5s
</span></span><span class="line"><span class="ln">37</span><span class="cl">kube-system   kube-apiserver-node1              1/1     Running   <span class="m">0</span>          4m
</span></span><span class="line"><span class="ln">38</span><span class="cl">kube-system   kube-controller-manager-node1     1/1     Running   <span class="m">1</span>          4m
</span></span><span class="line"><span class="ln">39</span><span class="cl">kube-system   kube-proxy-h2lgj                  1/1     Running   <span class="m">0</span>          3m16s
</span></span><span class="line"><span class="ln">40</span><span class="cl">kube-system   kube-scheduler-node1              1/1     Running   <span class="m">1</span>          4m
</span></span><span class="line"><span class="ln">41</span><span class="cl">kube-system   nodelocaldns-xnvv7                1/1     Running   <span class="m">0</span>          3m4s
</span></span></code></pre></div><p>参考链接：<br>
<a href="https://www.yxingxing.net/archives/ansible-20200214-var">ansible 变量详解</a><br>
<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_variables.html#variable-precedence-where-should-i-put-a-variable">ansible 变量优先级官方原文</a></p>

    </div>
<div class="post_comments">
  
  
    
 <script src="https://utteranc.es/client.js"
         repo="ZhangSIming-blyq/blogcommit"
         issue-term="pathname"
         theme="github-light"
         crossorigin="anonymous"
         async>
 </script>
 
  
  
</div>




  </article>
<aside class="sidebar">
  <section class="sidebar_inner">
    <br>
    
  
  <div class="search">
    <input type="search" class="search_field form_field" placeholder='Search...' id="find" autocomplete="off" data-scope='post'>
    <label for="find" class="search_label"><svg class="icon">
  <title>search</title>
  <use xlink:href="#search"></use>
</svg>

    </label>
    
    <div class="search_results results"></div>
  </div>


    
    
    <h2 class="mt-4">Featured Posts</h2>
    <ul>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/linux/etcd-tutorial/" class="nav-link" title="Etcd Tutorial">Etcd Tutorial</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/java/java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF1/" class="nav-link" title="【Java入门系列】Java基础入门 --- 安装，数据类型，类">【Java入门系列】Java基础入门 --- 安装，数据类型，类</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/closure/" class="nav-link" title="Closures In Golang And Python">Closures In Golang And Python</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/gozap/" class="nav-link" title="使用zap打造你的golang日志库">使用zap打造你的golang日志库</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/retrywatcher/" class="nav-link" title="client-go watch接口隔一段时间自动退出怎么办？">client-go watch接口隔一段时间自动退出怎么办？</a>
      </li>
    </ul>
    <h2 class="mt-4">Recent Posts</h2>
    <ul class="flex-column">
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/algorithm/programmercarl/day2/" class="nav-link" title="【算法刷题系列】第2天 209. 长度最小的子数组, 59. 螺旋矩阵 II">【算法刷题系列】第2天 209. 长度最小的子数组, 59. 螺旋矩阵 II</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/algorithm/programmercarl/day1/" class="nav-link" title="【算法刷题系列】第1天 704. 二分查找，27. 移除元素, 977.有序数组的平方">【算法刷题系列】第1天 704. 二分查找，27. 移除元素, 977.有序数组的平方</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/linux/neovim/" class="nav-link" title="Comprehensive Guide to Neovim">Comprehensive Guide to Neovim</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/linux/git%E7%9A%84cherry-pick%E6%93%8D%E4%BD%9C/" class="nav-link" title="git的cherry-pick操作">git的cherry-pick操作</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/kubernetes/kubernetes%E5%B8%B8%E8%A7%84%E9%97%AE%E9%A2%98/" class="nav-link" title="kubernetes常规问题">kubernetes常规问题</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/linux/%E4%B8%AD%E6%96%AD%E7%BB%91%E5%AE%9Acpu%E6%A0%B8%E5%BF%83%E9%97%AE%E9%A2%98/" class="nav-link" title="中断绑定cpu核心问题">中断绑定cpu核心问题</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/closure/" class="nav-link" title="Closures In Golang And Python">Closures In Golang And Python</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/gozap/" class="nav-link" title="使用zap打造你的golang日志库">使用zap打造你的golang日志库</a>
      </li>
      <li>
        <a href="https://zhangsiming-blyq.github.io/post/golang/retrywatcher/" class="nav-link" title="client-go watch接口隔一段时间自动退出怎么办？">client-go watch接口隔一段时间自动退出怎么办？</a>
      </li>
    </ul>
    <div>
      <h2 class="mt-4 taxonomy" id="categories-section">Categories</h2>
      <nav class="tags_nav">
        <a href='https://zhangsiming-blyq.github.io/categories/algorithm/' class="post_tag button button_translucent" title="algorithm">
          ALGORITHM
          <span class="button_tally">8</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">6</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/shorthand/' class="post_tag button button_translucent" title="shorthand">
          SHORTHAND
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/golang/' class="post_tag button button_translucent" title="golang">
          GOLANG
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/linux/' class="post_tag button button_translucent" title="linux">
          LINUX
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/python/' class="post_tag button button_translucent" title="python">
          PYTHON
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/ansible/' class="post_tag button button_translucent" title="ansible">
          ANSIBLE
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/apigateway/' class="post_tag button button_translucent" title="apigateway">
          APIGATEWAY
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/containerd/' class="post_tag button button_translucent" title="containerd">
          CONTAINERD
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/docker/' class="post_tag button button_translucent" title="docker">
          DOCKER
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/etcd/' class="post_tag button button_translucent" title="etcd">
          ETCD
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/git/' class="post_tag button button_translucent" title="git">
          GIT
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/java/' class="post_tag button button_translucent" title="java">
          JAVA
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/categories/vim/' class="post_tag button button_translucent" title="vim">
          VIM
          <span class="button_tally">1</span>
        </a>
        
        
      </nav>
    </div>
    <div>
      <h2 class="mt-4 taxonomy" id="tags-section">Tags</h2>
      <nav class="tags_nav">
        <a href='https://zhangsiming-blyq.github.io/tags/%E4%B8%AD%E6%96%87/' class="post_tag button button_translucent" title="中文">
          中文
          <span class="button_tally">15</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/english/' class="post_tag button button_translucent" title="english">
          ENGLISH
          <span class="button_tally">11</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/algorithm/' class="post_tag button button_translucent" title="algorithm">
          ALGORITHM
          <span class="button_tally">8</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/kubernetes/' class="post_tag button button_translucent" title="kubernetes">
          KUBERNETES
          <span class="button_tally">7</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/shorthand/' class="post_tag button button_translucent" title="shorthand">
          SHORTHAND
          <span class="button_tally">4</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/golang/' class="post_tag button button_translucent" title="golang">
          GOLANG
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/linux/' class="post_tag button button_translucent" title="linux">
          LINUX
          <span class="button_tally">3</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/etcd/' class="post_tag button button_translucent" title="etcd">
          ETCD
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/python/' class="post_tag button button_translucent" title="python">
          PYTHON
          <span class="button_tally">2</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/about/' class="post_tag button button_translucent" title="about">
          ABOUT
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/ansible/' class="post_tag button button_translucent" title="ansible">
          ANSIBLE
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/apigateway/' class="post_tag button button_translucent" title="apigateway">
          APIGATEWAY
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/apiserver/' class="post_tag button button_translucent" title="apiserver">
          APISERVER
          <span class="button_tally">1</span>
        </a>
        
        <a href='https://zhangsiming-blyq.github.io/tags/bailiyingqi/' class="post_tag button button_translucent" title="bailiyingqi">
          BAILIYINGQI
          <span class="button_tally">1</span>
        </a>
        
        
        <br>
        <div class="post_tags_toggle button">All Tags</div>
        <div class="post_tags">
          <div class="tags_list">
            
            <a href='https://zhangsiming-blyq.github.io/tags/about/' class=" post_tag button button_translucent" data-position=1 title="about">ABOUT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/algorithm/' class=" post_tag button button_translucent" data-position=8 title="algorithm">ALGORITHM<span class="button_tally">8</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/ansible/' class=" post_tag button button_translucent" data-position=1 title="ansible">ANSIBLE<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/apigateway/' class=" post_tag button button_translucent" data-position=1 title="apigateway">APIGATEWAY<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/apiserver/' class=" post_tag button button_translucent" data-position=1 title="apiserver">APISERVER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/bailiyingqi/' class=" post_tag button button_translucent" data-position=1 title="bailiyingqi">BAILIYINGQI<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/containerd/' class=" post_tag button button_translucent" data-position=1 title="containerd">CONTAINERD<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/controller-manager/' class=" post_tag button button_translucent" data-position=1 title="controller-manager">CONTROLLER-MANAGER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/english/' class=" post_tag button button_translucent" data-position=11 title="english">ENGLISH<span class="button_tally">11</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/etcd/' class=" post_tag button button_translucent" data-position=2 title="etcd">ETCD<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/git/' class=" post_tag button button_translucent" data-position=1 title="git">GIT<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/golang/' class=" post_tag button button_translucent" data-position=3 title="golang">GOLANG<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/java/' class=" post_tag button button_translucent" data-position=1 title="java">JAVA<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/kubernetes/' class=" post_tag button button_translucent" data-position=7 title="kubernetes">KUBERNETES<span class="button_tally">7</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/linux/' class=" post_tag button button_translucent" data-position=3 title="linux">LINUX<span class="button_tally">3</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/python/' class=" post_tag button button_translucent" data-position=2 title="python">PYTHON<span class="button_tally">2</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/scheduler/' class=" post_tag button button_translucent" data-position=1 title="scheduler">SCHEDULER<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/shorthand/' class=" post_tag button button_translucent" data-position=4 title="shorthand">SHORTHAND<span class="button_tally">4</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/vim/' class=" post_tag button button_translucent" data-position=1 title="vim">VIM<span class="button_tally">1</span>
            </a>
            
            
            <a href='https://zhangsiming-blyq.github.io/tags/%E4%B8%AD%E6%96%87/' class=" post_tag button button_translucent" data-position=15 title="中文">中文<span class="button_tally">15</span>
            </a>
            
            <div class="tags_sort"><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span>
            </div>
            <span class="tags_hide"><svg class="icon">
            <use xlink:href="#closeme"></use>
          </svg></span>
          </div>
        </div>
      </nav>
    </div>
  </section>
</aside>

  
</div>
    </main><svg width="0" height="0" class="hidden">
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter">
    <path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68 0 0 1-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043 0-1.924.366-2.643 1.078a3.56 3.56 0 0 0-1.076 2.605c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846 0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47 0 .929.273 1.705.82 2.388a3.623 3.623 0 0 0 2.115 1.291c-.312.08-.641.118-.979.118-.312 0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652 0 0 0 2.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422 0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139 0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77 0 0 0 1.172-4.892v-.468a7.788 7.788 0 0 0 1.84-1.921 8.142 8.142 0 0 1-2.11.593z"
      ></path>
  </symbol>
  <symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail">
    <path  d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar">
    <path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916 0 100v352c0 33.084 26.916 60 60 60h392c33.084 0 60-26.916 60-60V100c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028 0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028 0 20 8.972 20 20v48z"></path>
    <path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github">
    <path d="M255.968 5.329C114.624 5.329 0 120.401 0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384 0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008 0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992 0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584 0 34.368-.32 62.08-.32 70.496 0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab">
    <path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6 0L12.3 74.8z" />
    <path d="M12.3 74.7L.5 111c-1 3.2 0 6.8 3 8.8l101.6 74-92.5-119z"/>
    <path d="M105 193.7l-38.6-119h-54l92.7 119z"/>
    <path d="M105 193.7l38.7-119H66.4l38.7 119z"/>
    <path d="M105 193.7l38.7-119H198l-93 119z"/>
    <path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/>
    <path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6 0L198 74.8z"/> 
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss">
    <circle cx="3.429" cy="20.571" r="3.429"></circle>
    <path d="M11.429 24h4.57C15.999 15.179 8.821 8.001 0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path>
    <path d="M24 24C24 10.766 13.234 0 0 0v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin">
    <path d="M437 0H75C33.648 0 0 33.648 0 75v362c0 41.352 33.648 75 75 75h362c41.352 0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="to-top">
    <path d="M604.501 440.509L325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298 0 36.323s26.223 10.024 36.222 0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221 0 9.999-10.023 9.999-26.298 0-36.323z"></path>
  </symbol>
  <symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly">
    <path d="M504.971 239.029L448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c19.851 0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002 0 0 0 400 320v108c0 19.851-16.149 36-36 36h-44c-13.255 0-24 10.745-24 24s10.745 24 24 24h44c46.318 0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568 0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255 0 24-10.745 24-24S205.255 0 192 0h-44c-46.318 0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568 0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255 0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851 0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002 0 0 0 112 192z"></path>
  </symbol>
  <symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy">
    <path d="M23 2.75A2.75 2.75 0 0 0 20.25 0H8.75A2.75 2.75 0 0 0 6 2.75v13.5A2.75 2.75 0 0 0 8.75 19h11.5A2.75 2.75 0 0 0 23 16.25zM18.25 14.5h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5zm0-3h-7.5a.75.75 0 0 1 0-1.5h7.5a.75.75 0 0 1 0 1.5z"></path>
    <path d="M8.75 20.5a4.255 4.255 0 0 1-4.25-4.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752 0 0 0 1 5.25v16A2.752 2.752 0 0 0 3.75 24h12a2.752 2.752 0 0 0 2.75-2.75v-.75z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme">
    <path d="M284.286 256.002L506.143 34.144c7.811-7.811 7.811-20.475 0-28.285-7.811-7.81-20.475-7.811-28.285 0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285 0-7.81 7.811-7.811 20.475 0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475 0 28.285a19.938 19.938 0 0 0 14.143 5.857 19.94 19.94 0 0 0 14.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475 0-28.285L284.286 256.002z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu">
    <path d="M492 236H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954 0 96s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046 0-20 8.954-20 20s8.954 20 20 20h472c11.046 0 20-8.954 20-20s-8.954-20-20-20z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram">
    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id=youtube>
    <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow">
    <path d="M21 27v-8h3v11H0V19h3v8h18z"></path><path d="M17.1.2L15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8l13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="xing">
    <path d="M18.188 0c-.517 0-.741.325-.927.66 0 0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211 0 .375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016 0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894 0 21.686 0h-3.498zM3.648 4.74c-.211 0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016 0 .021L1.86 16.051c-.099.188-.093.381 0 .529.085.142.239.234.45.234h3.461c.518 0 .766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 71 55" id="discord">
    <path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"/>
  </symbol>
</svg>


<footer class="footer">
  <div class="footer_inner wrap pale">
    <img src='https://zhangsiming-blyq.github.io/icons/apple-touch-icon.png' class="icon icon_2 transparent" alt="">
    <p>Copyright&nbsp;<span class="year"></span>&nbsp;. All Rights Reserved</p><a class="to_top" href="#documentTop">
  <svg class="icon">
  <title>to-top</title>
  <use xlink:href="#to-top"></use>
</svg>

</a>

  </div>
</footer>

<script type="text/javascript" src="https://zhangsiming-blyq.github.io/en/js/bundle.daf5d72d10b0f1e048706d4cb8d79d1ec41c3b5edcd83acfaa4df80252afff936252c1fa7804d8dcdb500eaf0f7d5adbb79cfe886cf7068f12f58cdebc05e1c3.js" integrity="sha512-2vXXLRCw8eBIcG1MuNedHsQcO17c2DrPqk34AlKv/5NiUsH6eATY3NtQDq8PfVrbt5z&#43;iGz3Bo8S9YzevAXhww==" crossorigin="anonymous"></script>

  <script src="https://zhangsiming-blyq.github.io/js/search.min.9641a8a49c5a7dbd99f372bf456fc577a23b235fd157ee614ce2dab96b2e0f3687d5cc408d875f32e94405a2ccbca5c8bc43491cfce32471b72aa63e5315018d.js"></script>

  </body>
</html>
