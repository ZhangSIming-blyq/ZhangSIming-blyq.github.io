<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>golang on ç™¾é‡Œè‹±éªçš„åšå®¢</title>
    <link>https://zhangsiming-blyq.github.io/zh-cn/categories/golang/</link>
    <description>Recent content in golang on ç™¾é‡Œè‹±éªçš„åšå®¢</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Copyright Â© 2008â€“2018, Steve Francia and the Hugo Authors; all rights reserved.</copyright>
    <lastBuildDate>Thu, 10 Nov 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://zhangsiming-blyq.github.io/zh-cn/categories/golang/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>èŠä¸€èŠgolangã€pythonä¸­çš„é—­åŒ…</title>
      <link>https://zhangsiming-blyq.github.io/zh-cn/post/golang/closure/</link>
      <pubDate>Thu, 10 Nov 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/zh-cn/post/golang/closure/</guid>
      <description>
        
          
            æœ¬æ–‡ä¸ºgolangã€pythonæ–°æ‰‹é€šä¿—åœ°è§£é‡Šä»€ä¹ˆæ˜¯é—­åŒ…ï¼Œä»¥åŠåœ¨è¿™ä¸¤ç§è¯­è¨€ä¸­ä½¿ç”¨é—­åŒ…æ—¶å€™éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚æœ¬æ–‡è¿è¡Œçš„æ—¶å€™ä¿ç•™äº†packageã€importç­‰é‡å¤çš„ä»£ç éƒ¨åˆ†ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶å¤åˆ¶ä¸‹æ¥è‡ªå·±è·‘ä¸€ä¸‹ï¼ŒåŠ£åŠ¿æ˜¯å¯¼è‡´æœ‰éƒ¨åˆ†å†—æ‚ï¼Œè¿˜è¯·ç†è§£ã€‚
ä»€ä¹ˆæ˜¯é—­åŒ…? a closure is a record storing a function together with an environment.
é—­åŒ…çš„ä¸¤å¤§è¦ç´ ï¼šå‡½æ•°å’Œç¯å¢ƒ
å‡½æ•°ï¼šæŒ‡çš„æ˜¯åœ¨é—­åŒ…å®é™…å®ç°çš„æ—¶å€™ï¼Œå¾€å¾€é€šè¿‡è°ƒç”¨ä¸€ä¸ªå¤–éƒ¨å‡½æ•°è¿”å›å…¶å†…éƒ¨å‡½æ•°æ¥å®ç°çš„ã€‚å†…éƒ¨å‡½æ•°å¯èƒ½æ˜¯å†…éƒ¨å®åå‡½æ•°ã€åŒ¿åå‡½æ•°æˆ–è€…ä¸€æ®µlambdaè¡¨è¾¾å¼; ç¯å¢ƒï¼šåœ¨å®é™…ä¸­å¼•ç”¨ç¯å¢ƒæ˜¯æŒ‡å¤–éƒ¨å‡½æ•°çš„ç¯å¢ƒï¼Œé—­åŒ…ä¿å­˜/è®°å½•äº†å®ƒäº§ç”Ÿæ—¶çš„å¤–éƒ¨å‡½æ•°çš„æ‰€æœ‰ç¯å¢ƒ; ç»¼ä¸Šï¼Œé—­åŒ…æ˜¯ä¸€ç§å»¶ä¼¸äº†ä½œç”¨åŸŸçš„å‡½æ•°ï¼Œä»–ä¼šä¿ç•™å®šä¹‰å‡½æ•°æ—¶å­˜åœ¨çš„è‡ªç”±å˜é‡(æœªåœ¨æœ¬åœ°ä½œç”¨åŸŸä¸­ç»‘å®šçš„å˜é‡)çš„ç»‘å®šï¼Œè¿™æ ·è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ‰€ä»¥å®šä¹‰ä½œç”¨åŸŸä¸å¯ç”¨äº†ï¼Œä½†æ˜¯ä»èƒ½ä½¿ç”¨é‚£äº›ç»‘å®šã€‚ä¸‹é¢çœ‹ä¸€ä¸‹é—­åŒ…çš„å¸¸è§ç”¨æ³•ï¼š
golang:
1package main 2 3import &amp;#34;fmt&amp;#34; 4 5func outer() func(v int) { 6 x := 1 7 return func(v int) { 8 y := x + v 9 fmt.Println(x) 10 fmt.Println(y) 11 } 12} 13 14func main() { 15 a := outer() 16 a(1) 17 a(2) 18} 19 20// è¾“å‡ºç»“æœ 211 222 231 243 golangä¾‹å­é‡Œé¢çš„é€»è¾‘ä¸­ï¼Œaæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…å‡½æ•°ä¸ºå†…éƒ¨çš„func(v int){}, é—­åŒ…ç¯å¢ƒä¸ºå¤–éƒ¨çš„x, ç”±äº&#39;æ•è·&#39;äº†å¤–éƒ¨ç¯å¢ƒï¼Œæ‰€ä»¥æ¯æ¬¡æ‰§è¡Œé—­åŒ…xéƒ½æ˜¯1ï¼Œæœ€åè¾“å‡ºç»“æœ1,2,1,3ã€‚
          
          
        
      </description>
    </item>
    
    <item>
      <title>ä½¿ç”¨zapæ‰“é€ ä½ çš„golangæ—¥å¿—åº“</title>
      <link>https://zhangsiming-blyq.github.io/zh-cn/post/golang/gozap/</link>
      <pubDate>Fri, 28 Oct 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/zh-cn/post/golang/gozap/</guid>
      <description>
        
          
            è¿‘æœŸé…ç½®äº†uberå®¶çš„zapæ—¥å¿—åº“ï¼Œè§‰å¾—æ€§èƒ½æ¯”è¾ƒå¼ºï¼Œå±•ç¤ºæ¯”è¾ƒç¾è§‚ï¼Œåœ¨è¿™é‡Œåšä¸€ä¸ªåˆ†äº«ï¼Œä»£ç åœ¨ç¬¬ä¸‰éƒ¨åˆ†å¯ä»¥è‡ªå–ã€‚
ä¸ºä»€ä¹ˆä¸é€‰æ‹©åŸç”Ÿlog? è¯´èµ·golangå¦‚ä½•ä¼˜é›…çš„æ‰“å°æ—¥å¿—ï¼Œä»»ä½•ä¸€ä¸ªgolangçš„åˆå­¦è€…å¤§æ¦‚éƒ½æ˜¯ç”¨çš„åŸç”Ÿlogåº“ï¼Œæˆ–è€…ç›´æ¥fmt.Println()...ä½†æ˜¯è¿™ç§æ–¹å¼å¹¶ä¸ä¼˜é›…ï¼Œå¹¶ä¸”æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼š
å¯¹äºåŸºç¡€æ—¥å¿—ï¼šä¸èƒ½ç»†ç²’åº¦åŒºåˆ†infoå’Œdebugçº§åˆ«çš„æ—¥å¿—; å¯¹äºé”™è¯¯æ—¥å¿—: ä¸æ”¯æŒé™¤äº†fatalæˆ–è€…panicçš„æ™®é€šerrorçº§åˆ«å‘ŠçŸ¥ã€‚ logç¤ºä¾‹ 1package main 2 3import &amp;#34;log&amp;#34; 4 5func main() { 6 log.Print(&amp;#34;info or debug&amp;#34;) 7 log.Fatal(&amp;#34;fatal&amp;#34;) 8 log.Panic(&amp;#34;panic&amp;#34;) 9} 10 11// è¾“å‡ºå¦‚ä¸‹ 122022/11/23 22:23:32 info or debug 132022/11/23 22:23:32 fatal 14exit status 1 ä¸ºä»€ä¹ˆä¸é€‰æ‹©logrus? logrusä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„è‡ªå®šä¹‰æ—¥å¿—åº“ï¼Œä¸è¿‡å› ä¸ºGoè¯­è¨€æ˜¯ä¸€é—¨å¼ºç±»å‹çš„é™æ€è¯­è¨€ï¼Œè€Œlogruséœ€è¦çŸ¥é“æ•°æ®çš„ç±»å‹æ¥æ‰“å°æ—¥å¿—ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå®ç°æ–¹æ¡ˆæ˜¯ä½¿ç”¨åå°„ï¼Œè¿™å¯¼è‡´å¤§é‡åˆ†é…è®¡æ•°ã€‚è™½ç„¶é€šå¸¸ä¸æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼ˆå–å†³äºä»£ç ï¼‰ï¼Œä½†æ˜¯åœ¨å¤§è§„æ¨¡ã€é«˜å¹¶å‘çš„é¡¹ç›®ä¸­é¢‘ç¹çš„åå°„å¼€é”€å½±å“å¾ˆå¤§ï¼Œæ‰€ä»¥è¿™é‡Œä¸è¿›è¡Œé‡‡ç”¨ã€‚
ä»“åº“é“¾æ¥: logrus
logrusç¤ºä¾‹ 1package main 2 3import log &amp;#34;github.com/sirupsen/logrus&amp;#34; 4 5var logger = log.New() 6 7func main() { 8 // è¿™é‡Œå¯ä»¥é€šè¿‡WithFieldsæ¥é™„åŠ å­—æ®µ 9 logger.WithFields(log.Fields{&amp;#34;testfield&amp;#34;: &amp;#34;test&amp;#34;}).Info(&amp;#34;test info&amp;#34;) 10 logger.Info(&amp;#34;info&amp;#34;) 11 logger.
          
          
        
      </description>
    </item>
    
    <item>
      <title>client-go watchæ¥å£éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨é€€å‡ºæ€ä¹ˆåŠï¼Ÿ</title>
      <link>https://zhangsiming-blyq.github.io/zh-cn/post/golang/retrywatcher/</link>
      <pubDate>Sat, 28 May 2022 00:00:00 +0000</pubDate>
      
      <guid>https://zhangsiming-blyq.github.io/zh-cn/post/golang/retrywatcher/</guid>
      <description>
        
          
            åœ¨ä½¿ç”¨client-goçš„watchæ¥å£æ—¶å€™ç¢°åˆ°å¼‚å¸¸é€€å‡ºé—®é¢˜ï¼ŒæŸ¥äº†ä¸€ä¸‹googleæ²¡æœ‰å¤šå°‘ä¿¡æ¯ï¼Œäºæ˜¯æ‰’äº†ä¸€ä¸‹ä»£ç ï¼ŒæŠŠè‡ªå·±è¸©çš„å‘è®°å½•ä¸‹æ¥æ–¹ä¾¿ä»¥åè‡ªæŸ¥è‡ªçº ã€‚
ä½¿ç”¨client-go watchæ¥å£ ğŸ’¡ å…¨å±€çš„myclusteréƒ½ç­‰äº*kubernetes.Clientset 1. å¦‚ä½•watch ç”±äºkubernetesæ•´åˆäº†etcdçš„watchåŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡watchæ“ä½œå»å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥ï¼Œä¸æ–­çš„æ¥æ”¶æ•°æ®ï¼›è¿™ç§æ–¹å¼è¦ä¼˜äºæ™®é€šçš„åå¤è½®è¯¢è¯·æ±‚ï¼Œé™ä½serverç«¯çš„å‹åŠ›;
ä½¿ç”¨client-goè°ƒç”¨å¯¹åº”å¯¹è±¡çš„Watch()æ–¹æ³•ä¹‹åï¼Œä¼šè¿”å›ä¸€ä¸ªwatch.Eventå¯¹è±¡ï¼Œå¯ä»¥å¯¹å…¶ä½¿ç”¨ResultChan()æ¥å—watchåˆ°çš„å¯¹è±¡ã€‚
1pod, err := mycluster.Clusterclientset.CoreV1().Pods(appNamespace).Watch(context.TODO(), metav1.ListOptions{LabelSelector: label}) 2if err != nil { 3 log.Error(err) 4} 5... 6event, ok := &amp;lt;-pod.ResultChan() 7if !ok { 8 log.Error(err) 9} å¼‚å¸¸ï¼šwatchæ¥å£è‡ªåŠ¨æ–­å¼€ 1. ç°è±¡ åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œwatchæ“ä½œæŒç»­ä¸€æ®µæ—¶é—´å°±ä¼šè‡ªåŠ¨æ–­å¼€
2. æ’æŸ¥ æˆ‘ä»¬è¿›å…¥watchåŒ…é‡Œé¢æ‰¾åˆ°streamwatcher.goï¼Œå…¶ä¸­èŠ‚é€‰äº†ä¸€äº›é‡è¦ç‰‡æ®µï¼š
1type StreamWatcher struct { 2	sync.Mutex 3	source Decoder 4	reporter Reporter 5	result chan Event 6	stopped bool 7} 8... 9func NewStreamWatcher(d Decoder, r Reporter) *StreamWatcher { 10	sw := &amp;amp;StreamWatcher{ 11	source: d, 12	reporter: r, 13	// It&amp;#39;s easy for a consumer to add buffering via an extra 14	// goroutine/channel, but impossible for them to remove it, 15	// so nonbuffered is better.
          
          
        
      </description>
    </item>
    
  </channel>
</rss>
